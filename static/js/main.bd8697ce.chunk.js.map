{"version":3,"sources":["features/settingSlices.ts","utils/storage.ts","components/commons/Popover.tsx","features/peerSlices.ts","components/NavBar/PeerListItem.tsx","hooks/usePeer.ts","components/NavBar/PeerList.tsx","components/NavBar/PeerGroup.tsx","components/commons/Dialog.tsx","components/commons/Fade.tsx","features/docSlices.ts","components/NavBar/ShareButton.tsx","components/NavBar/NetworkButton.tsx","components/NavBar/index.tsx","components/Editor/CodeEditor/Cursor.ts","components/Editor/CodeEditor/slideView.ts","components/Editor/CodeEditor/codemirror/shuffle.ts","components/Editor/CodeEditor/index.tsx","features/boardSlices.ts","utils/eventDispatcher.ts","components/Editor/DrawingBoard/Canvas/CanvasWrapper.ts","components/Editor/DrawingBoard/Canvas/line.ts","components/Editor/DrawingBoard/Canvas/utils.ts","components/Editor/DrawingBoard/Canvas/rect.ts","components/Editor/DrawingBoard/Canvas/dom.ts","components/Editor/DrawingBoard/Canvas/scheduler.ts","components/Editor/DrawingBoard/Canvas/Worker/Worker.ts","components/Editor/DrawingBoard/Canvas/Worker/LineWorker.ts","components/Editor/DrawingBoard/Canvas/Worker/RectWorker.ts","components/Editor/DrawingBoard/Canvas/Board.ts","components/Editor/DrawingBoard/Canvas/Worker/EraserWorker.ts","components/Editor/DrawingBoard/Canvas/Worker/SelectorWorker.ts","components/Editor/DrawingBoard/Canvas/Worker/NoneWorker.ts","components/Editor/DrawingBoard/index.tsx","assets/icons/Eraser.tsx","assets/icons/Mouse.tsx","assets/icons/Rect.tsx","components/Editor/Sidebar/Settings.tsx","components/Editor/Sidebar/ButtonWithColor.tsx","components/Editor/Sidebar/index.tsx","components/Editor/Editor.tsx","components/Editor/index.tsx","pages/DocPage.tsx","app/App.tsx","app/rootReducer.ts","app/store.ts","serviceWorker.ts","index.tsx"],"names":["Theme","CodeKeyMap","TabSize","BrowserStorage","key","storage","this","window","localStorage","initial","JSON","parse","value","stringify","SettingModel","prefersDark","matchMedia","matches","initialState","getValue","menu","theme","Dark","Light","codeKeyMap","Sublime","tabSize","Two","settingSlice","createSlice","name","reducers","setDarkMode","state","action","payload","setValue","setCodeKeyMap","setTabSize","actions","Popover","anchorEl","onClose","children","anchorOrigin","transformOrigin","isOpen","Boolean","id","undefined","open","defaultProps","vertical","horizontal","ConnectionStatus","useStyles","makeStyles","root","props","color","peer","presence","PeerListItem","classes","ListItem","className","username","peerSlice","peers","syncPeer","myClientID","changedPeers","Object","keys","clientID","status","Disconnected","entries","Connected","isMine","usePeer","client","useSelector","docState","peerState","activePeers","useMemo","values","filter","PeerList","List","Typography","length","map","group","cursor","myAvatar","borderColor","palette","secondary","main","PeerGroup","useState","setAnchorEl","handleViewList","useCallback","event","target","getAttribute","currentTarget","handleViewListClose","AvatarGroup","max","onClick","image","Tooltip","title","arrow","Avatar","alt","style","backgroundColor","src","anonymous","getImage","DialogTitle","withStyles","createStyles","margin","padding","spacing","closeButton","position","right","top","grey","other","disableTypography","variant","IconButton","DialogContent","MuiDialogContent","DialogActions","MuiDialogActions","Dialog","maxWidth","Fade","timeout","show","onFadeout","timeoutId","useRef","useEffect","current","setTimeout","clearTimeout","in","Preview","CodeMode","DocStatus","mode","Markdown","preview","HTML","loading","errorMessage","Connect","activateClient","createAsyncThunk","_","thunkApi","a","generate","animal","options","apiKey","randomColor","board","process","yorkie","Client","activate","rejectWithValue","message","attachDoc","doc","attach","update","content","Text","shapes","sync","docSlice","deactivateClient","deactivate","createDocument","Document","detachDocument","detach","attachDocLoading","setCodeMode","setPreview","setStatus","extraReducers","builder","addCase","fulfilled","rejected","dialog","borderRadius","input","width","fontSize","outline","box","display","button","lineHeight","ShareButton","setOpen","showCopyText","setShowCopyText","inputRef","copyUrl","location","href","split","onFocus","select","onCopy","openModal","closeModal","Button","size","startIcon","disabled","Disconnect","dividers","Box","my","DialogContentText","readOnly","ref","text","autoFocus","fontWeight","NetworkAlert","subTitle","px","py","p","pb","NetworkDisconnect","hasLocalChanges","handleOpen","handleClose","NetworkConnect","NetworkButton","flexGrow","appBar","grow","primary","marginRight","textDecoration","items","MenuAppBar","AppBar","Toolbar","Link","underline","rel","memo","CursorStatus","Cursor","height","marker","lineMarker","nameRemoveTimeMap","nameAnimationDelay","nameAnimationDuration","nameRemoveTime","Deactivated","Map","cm","cursorPos","removeCursor","Activated","cursorCoords","cursorHolder","document","createElement","bottom","classList","add","borderLeftColor","setBookmark","widget","insertLeft","showCursorNameReserve","fromPos","toPos","removeLine","redColor","parseInt","slice","greenColor","blueColor","getDoc","markText","css","nameHolder","addEventListener","has","get","textContent","invert","remove","appendChild","animationDuration","animationDelay","removeNameReserve","parentNode","removeChild","delete","set","clear","SlideView","marpit","Marpit","inlineSVG","themeSet","default","markdown","render","CodeMirror","Vim","defineEx","params","lineStart","line","firstLine","lineEnd","lastLine","curStart","Pos","curEnd","getLine","getRange","i","j","Math","floor","random","replaceRange","join","cachedTableOfContents","generateTableOfContents","editorInstance","count","lineCount","headings","match","level","push","originalText","returnValue","isCached","displayTableOfContents","list","toc","getElementById","innerHTML","heading","encodeURIComponent","Color","ToolType","dark","common","white","background","paper","CodeEditor","forwardedRef","settingState","cursorMapRef","editor","setEditor","connectCursor","disconnectCursor","getCmInstanceCallback","goHeadingLink","searchText","decodeURIComponent","hash","replace","getSearchCursor","find","setCursor","from","scrollIntoView","toggleTableOfContents","el","updateCursor","pos","syncText","subscribe","type","actor","change","getID","getActorID","isActive","posFromIndex","on","instance","metaKey","coordsChar","left","clientX","clientY","token","getTokenAt","includes","string","origin","indexFromPos","to","edit","data","ranges","anchor","head","changeEventHandler","changes","forEach","updateLine","getRoot","onChanges","toString","addKeyMap","setOption","clearHistory","focus","tableOfContents","contains","opts","spellChecker","placeholder","Number","maxHeight","NAVBAR_HEIGHT","toolbar","codemirror","unorderedListStyle","shortcuts","toggleUnorderedList","Slide","slideView","previewRender","previewElement","html","self","ThemeType","getCodemirrorInstance","initialBoardState","Yellow","toolType","None","boardSlice","toggleBoard","setTool","setColor","Event","callbacks","cb","idx","findIndex","callback","splice","EventDispatcher","events","args","off","CanvasWrapper","canvas","context","getContext","lineWidth","lineCap","setWidth","setHeight","devicePixelRatio","clearRect","getWidth","getHeight","setSize","scale","drawTrace","points","strokeStyle","beginPath","moveTo","x","y","lineTo","stroke","drawLine","curves","fitCurve","save","firstCurve","curve","bezierCurveTo","closePath","restore","drawEraser","isMoved","fixEraserPoint","point","getSqDist","p1","p2","dx","dy","getSqSegDist","t","douglasPeuckerStep","first","last","tolerance","simplified","maxDist","index","dist","douglasPeucker","simplifyRadialDist","prevPoint","len","compressPoints","checkLineIntersection","point1Start","point1End","point2Start","point2End","b","result","onLine1","onLine2","denominator","numerator1","numerator2","cloneBox","isInnerBox","offsetY","offsetX","isSelectable","shape","drawRect","rect","strokeRect","addEvent","fn","capturing","removeEvent","removeEventListener","touch","mouseup","mouseout","mousedown","mousemove","touchy","work","Worker","createID","getElementByID","deleteByID","LineWorker","Line","previewLine","createLine","flushTask","lastShape","getLast","drawAll","RectWorker","Rect","previewRect","createRect","rectPoint","aWidth","abs","aHeight","adjustRectBox","tasks","doWork","requestTask","isDone","reserveTask","task","_work","DragStatus","EraserWorker","Eraser","eraserBoxSize","selectPoint","eraserPoints","scheduler","pointStart","pointEnd","findAndRemoveShape","point1","point2","shapePoint1","shapePoint2","eraserBox","SelectorWorker","Selector","selectedShape","findTarget","isEmptySelectedShape","NoneWorker","Board","Black","dragStatus","Stop","lowerWrapper","upperWrapper","presenceMap","worker","createUpperWrapper","initialize","initializeSize","initializeOffset","emit","bind","onMouseUp","onMouseOut","onMouseDown","onMouseMove","getCanvas","destroyUpperCanvas","getBoundingClientRect","resize","wrapper","upperCanvas","tool","setMouseClass","createWorker","Clear","TypeError","evt","originY","originX","TouchEvent","touches","scrollY","scrollX","Drag","getPointFromTouchyEvent","boardPresence","isOutside","peerKey","clearAll","DrawingBoard","canvasRef","boardRef","dispatch","useDispatch","boardState","destroy","unsubscribe","documentKey","getKey","updatePresence","clientId","handleUpdateMeta","handleMouseup","clearBoard","SvgIcon","version","viewBox","d","Mouse","xmlns","enableBackground","minWidth","header","borderBottom","item","justifyContent","marginTop","itemTitle","whiteSpace","alignItems","itemInfo","paddingLeft","textAlign","Settings","handlePreviewChange","handleChange","handleThemeChanged","checked","FormControl","Select","onChange","displayEmpty","MenuItem","Switch","marginLeft","flexWrap","colorIcon","badge","ButtonWithColor","Icon","tooltip","currentToolType","handleSelectTool","Badge","nextColor","_color","selected","border","flexDirection","divider","marginBottom","Sidebar","nextTool","handleSettingsClick","handleSettingsClose","BrushIcon","RectIcon","Divider","flex","codeEditor","pointerEvents","Editor","divRef","codeEditorRef","handleClickEditor","onResize","docKey","attachDocAsync","Snackbar","Alert","severity","CircularProgress","DocPage","useLocation","ReactGA","send","NavBar","history","createBrowserHistory","Sentry","dsn","release","integrations","Integrations","BrowserTracing","routingInstrumentation","tracesSampleRate","App","createMuiTheme","handleRender","substring","ThemeProvider","CssBaseline","path","exact","component","rootReducer","combineReducers","docReducer","peerReducer","settingReducer","boardReducer","store","configureStore","reducer","middleware","getDefaultMiddleware","serializableCheck","ignoredActions","ignoredPaths","immutableCheck","hostname","trackingCode","ReactDOM","querySelector","navigator","serviceWorker","ready","then","registration","unregister","catch","error","console"],"mappings":"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","file":"static/js/main.bd8697ce.chunk.js","sourcesContent":["import { createSlice, PayloadAction } from '@reduxjs/toolkit';\nimport BrowserStorage from 'utils/storage';\n\nexport enum Theme {\n  Dark = 'dark',\n  Light = 'light',\n}\n\nexport enum CodeKeyMap {\n  Sublime = 'sublime',\n  Vim = 'vim',\n  Emacs = 'emacs',\n}\n\nexport enum TabSize {\n  Two = '2',\n  Four = '4',\n  Eight = '8',\n}\n\nexport type MenuKey = 'theme' | 'codeKeyMap' | 'tabSize';\n\nexport type Menu = Record<MenuKey, string>;\n\nexport interface SettingState {\n  menu: Menu;\n}\n\nconst SettingModel = new BrowserStorage<SettingState>('$$codepair$$setting');\n\nconst prefersDark: boolean = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;\n\nconst initialState: SettingState = SettingModel.getValue({\n  menu: {\n    theme: prefersDark ? Theme.Dark : Theme.Light,\n    codeKeyMap: CodeKeyMap.Sublime,\n    tabSize: TabSize.Two,\n  },\n});\n\nconst settingSlice = createSlice({\n  name: 'setting',\n  initialState,\n  reducers: {\n    setDarkMode(state, action: PayloadAction<boolean>) {\n      state.menu.theme = action.payload ? Theme.Dark : Theme.Light;\n      SettingModel.setValue(state);\n    },\n\n    setCodeKeyMap(state, action: PayloadAction<CodeKeyMap>) {\n      state.menu.codeKeyMap = action.payload;\n      SettingModel.setValue(state);\n    },\n\n    setTabSize(state, action: PayloadAction<TabSize>) {\n      state.menu.tabSize = action.payload;\n      SettingModel.setValue(state);\n    },\n  },\n});\n\nexport const { setDarkMode, setCodeKeyMap, setTabSize } = settingSlice.actions;\nexport default settingSlice.reducer;\n","export default class BrowserStorage<T> {\n  key: string;\n\n  storage: Storage;\n\n  constructor(key: string) {\n    this.key = key;\n    this.storage = window.localStorage;\n  }\n\n  getValue(initial: T): T {\n    try {\n      return JSON.parse(this.storage[this.key]) as T;\n    } catch {\n      return initial;\n    }\n  }\n\n  setValue(value: T) {\n    this.storage[this.key] = JSON.stringify(value);\n  }\n}\n","import React, { ReactNode } from 'react';\nimport { Popover as MaterialPopover, PopoverOrigin } from '@material-ui/core';\n\ninterface PopoverProps {\n  anchorEl: Element | undefined;\n  onClose: (event: {}, reason: 'backdropClick' | 'escapeKeyDown') => void;\n  children: ReactNode;\n  anchorOrigin?: PopoverOrigin;\n  transformOrigin?: PopoverOrigin;\n}\n\n/**\n * @see https://material-ui.com/components/popover/#popover\n */\nexport default function Popover({ anchorEl, onClose, children, anchorOrigin, transformOrigin }: PopoverProps) {\n  const isOpen = Boolean(anchorEl);\n\n  return (\n    <MaterialPopover\n      id={isOpen ? 'simple-popover' : undefined}\n      open={isOpen}\n      anchorEl={anchorEl}\n      onClose={onClose}\n      anchorOrigin={anchorOrigin}\n      transformOrigin={transformOrigin}\n    >\n      {children}\n    </MaterialPopover>\n  );\n}\n\nPopover.defaultProps = {\n  anchorOrigin: {\n    vertical: 'bottom',\n    horizontal: 'center',\n  },\n  transformOrigin: {\n    vertical: 'top',\n    horizontal: 'center',\n  },\n};\n","import { ActorID } from 'yorkie-js-sdk';\nimport { createSlice, PayloadAction } from '@reduxjs/toolkit';\n\nexport interface Presence {\n  username: string;\n  color: string;\n  image: string; // Currently all anonymous images\n  board: string;\n}\n\nexport enum ConnectionStatus {\n  Connected = 'connected',\n  Disconnected = 'disconnected',\n}\n\nexport interface Peer {\n  id: ActorID;\n  status: ConnectionStatus;\n  presence: Presence;\n  isMine: boolean;\n}\n\nexport interface PeerState {\n  peers: Record<string, Peer>;\n}\n\nexport interface SyncPeerPayLoad {\n  myClientID: ActorID;\n  changedPeers: Record<string, Presence>;\n}\n\nconst initialPeerState: PeerState = {\n  peers: {},\n};\n\nconst peerSlice = createSlice({\n  name: 'peer',\n  initialState: initialPeerState,\n  reducers: {\n    syncPeer(state, action: PayloadAction<SyncPeerPayLoad>) {\n      const { myClientID, changedPeers } = action.payload;\n      const { peers } = state;\n\n      for (const clientID of Object.keys(peers)) {\n        if (!changedPeers[clientID]) {\n          peers[clientID].status = ConnectionStatus.Disconnected;\n        }\n      }\n\n      for (const [clientID, presence] of Object.entries(changedPeers)) {\n        if (!peers[clientID] || peers[clientID].status === ConnectionStatus.Disconnected) {\n          const peer = {\n            id: clientID,\n            status: ConnectionStatus.Connected,\n            presence,\n            isMine: myClientID === clientID,\n          };\n          state.peers[clientID] = peer;\n        }\n      }\n    },\n  },\n});\n\nexport const { syncPeer } = peerSlice.actions;\nexport default peerSlice.reducer;\n","import React from 'react';\nimport ListItem from '@material-ui/core/ListItem';\nimport { makeStyles } from '@material-ui/core/styles';\n\nimport { Peer } from 'features/peerSlices';\n\ninterface PeerListItemProps {\n  peer: Peer;\n}\n\nconst useStyles = makeStyles(() => ({\n  root: (props: PeerListItemProps) => ({\n    color: props.peer.presence.color,\n  }),\n}));\n\nexport default function PeerListItem(props: PeerListItemProps) {\n  const classes = useStyles(props);\n  const { peer } = props;\n\n  return <ListItem className={classes.root}>{peer.presence.username}</ListItem>;\n}\n","/* eslint-disable @typescript-eslint/indent */\n/* eslint-disable @typescript-eslint/no-unused-vars */\nimport { useMemo } from 'react';\nimport { useSelector } from 'react-redux';\n\nimport { AppState } from 'app/rootReducer';\nimport { ConnectionStatus } from 'features/peerSlices';\n\nexport default function usePeer() {\n  const client = useSelector((state: AppState) => state.docState.client);\n  const peers = useSelector((state: AppState) => state.peerState.peers);\n\n  const activePeers = useMemo(() => {\n    if (!client) {\n      return [];\n    }\n    return Object.values(peers).filter((peer) => peer.status === ConnectionStatus.Connected);\n  }, [client, peers]);\n\n  return { activePeers };\n}\n","import React from 'react';\nimport Typography from '@material-ui/core/Typography';\nimport List from '@material-ui/core/List';\nimport ListItem from '@material-ui/core/ListItem';\n\nimport PeerListItem from 'components/NavBar/PeerListItem';\nimport usePeer from 'hooks/usePeer';\n\nexport default function PeerList() {\n  const { activePeers } = usePeer();\n\n  return (\n    <List>\n      <ListItem>\n        <Typography>Total {activePeers.length}</Typography>\n      </ListItem>\n      {activePeers.map((peer) => {\n        return <PeerListItem key={peer.id} peer={peer} />;\n      })}\n    </List>\n  );\n}\n","import React, { useState, useCallback, MouseEvent } from 'react';\nimport { useSelector } from 'react-redux';\nimport Avatar from '@material-ui/core/Avatar';\nimport AvatarGroup from '@material-ui/lab/AvatarGroup';\nimport Tooltip from '@material-ui/core/Tooltip';\nimport { makeStyles } from '@material-ui/core/styles';\nimport anonymous from 'anonymous-animals-gen';\n\nimport Popover from 'components/commons/Popover';\nimport PeerList from 'components/NavBar/PeerList';\nimport { AppState } from 'app/rootReducer';\nimport usePeer from 'hooks/usePeer';\n\nconst useStyles = makeStyles((theme) => ({\n  group: {\n    '& > *': {\n      cursor: 'pointer',\n    },\n  },\n  myAvatar: {\n    borderColor: theme.palette.secondary.main,\n  },\n}));\n\nconst MAX_PEER_VIEW = 4;\n\nexport default function PeerGroup() {\n  const classes = useStyles();\n  const client = useSelector((state: AppState) => state.docState.client);\n  const { activePeers } = usePeer();\n  const [anchorEl, setAnchorEl] = useState<Element | undefined>();\n\n  const handleViewList = useCallback(\n    (event: MouseEvent<Element>) => {\n      const target = event.target as HTMLTextAreaElement;\n      if (!target.getAttribute('data-id')) {\n        setAnchorEl(event.currentTarget);\n      }\n    },\n    [setAnchorEl],\n  );\n\n  const handleViewListClose = useCallback(() => {\n    setAnchorEl(undefined);\n  }, [setAnchorEl]);\n\n  if (!client) {\n    // NOTE: We use null as an exception to prevent component from rendering.\n    return null;\n  }\n\n  return (\n    <>\n      <AvatarGroup className={classes.group} max={MAX_PEER_VIEW} onClick={handleViewList}>\n        {activePeers.map((peer) => {\n          const { username, color, image } = peer.presence;\n          return (\n            <Tooltip key={peer.id} title={peer.isMine ? `[ME] ${username}` : username} data-id={peer.id} arrow>\n              <Avatar\n                alt=\"Peer Image\"\n                className={peer.isMine ? classes.myAvatar : ''}\n                style={{ backgroundColor: color }}\n                src={anonymous.getImage(image)}\n              />\n            </Tooltip>\n          );\n        })}\n      </AvatarGroup>\n      <Popover anchorEl={anchorEl} onClose={handleViewListClose}>\n        <PeerList />\n      </Popover>\n    </>\n  );\n}\n","import React from 'react';\nimport { createStyles, Theme, withStyles, WithStyles } from '@material-ui/core/styles';\nimport MaterialDialog, { DialogProps as MaterialDialogProps } from '@material-ui/core/Dialog';\nimport MuiDialogTitle from '@material-ui/core/DialogTitle';\nimport MuiDialogContent from '@material-ui/core/DialogContent';\nimport MuiDialogActions from '@material-ui/core/DialogActions';\nimport IconButton from '@material-ui/core/IconButton';\nimport CloseIcon from '@material-ui/icons/Close';\nimport Typography from '@material-ui/core/Typography';\n\nexport { DialogContentText } from '@material-ui/core';\n\nconst styles = (theme: Theme) =>\n  createStyles({\n    root: {\n      margin: 0,\n      padding: theme.spacing(2),\n    },\n    closeButton: {\n      position: 'absolute',\n      right: theme.spacing(1),\n      top: theme.spacing(1),\n      color: theme.palette.grey[500],\n    },\n  });\n\ninterface DialogTitleProps extends WithStyles<typeof styles> {\n  children: React.ReactNode;\n  onClose?: () => void;\n}\n\nexport const DialogTitle = withStyles(styles)((props: DialogTitleProps) => {\n  const { children, classes, onClose, ...other } = props;\n  return (\n    <MuiDialogTitle disableTypography className={classes.root} {...other}>\n      <Typography variant=\"h6\">{children}</Typography>\n      {onClose ? (\n        <IconButton aria-label=\"close\" className={classes.closeButton} onClick={onClose}>\n          <CloseIcon />\n        </IconButton>\n      ) : null}\n    </MuiDialogTitle>\n  );\n});\n\nexport const DialogContent = withStyles((theme: Theme) => ({\n  root: {\n    padding: theme.spacing(2),\n  },\n}))(MuiDialogContent);\n\nexport const DialogActions = withStyles((theme: Theme) => ({\n  root: {\n    margin: 0,\n    padding: theme.spacing(1),\n  },\n}))(MuiDialogActions);\n\ninterface DialogProps extends MaterialDialogProps {\n  open: boolean;\n  onClose: () => void;\n  className?: string;\n  children: React.ReactNode;\n}\n\n/**\n * {@see https://material-ui.com/components/dialogs/#customized-dialogs}\n */\nfunction Dialog({ open, onClose, className, children }: DialogProps) {\n  if (!open) {\n    return null;\n  }\n\n  return (\n    <MaterialDialog onClose={onClose} open={open} maxWidth=\"md\">\n      <div className={className}>{children}</div>\n    </MaterialDialog>\n  );\n}\n\nDialog.defaultProps = {\n  className: '',\n};\n\nexport default Dialog;\n","/* eslint-disable react-hooks/exhaustive-deps */\nimport React, { useEffect, useRef, ReactNode } from 'react';\nimport MaterialFade from '@material-ui/core/Fade';\n\ninterface FadeProps {\n  timeout?: number;\n  show: boolean;\n  onFadeout: Function;\n  children: ReactNode;\n}\n\nfunction Fade({ timeout, show, onFadeout, children }: FadeProps) {\n  const timeoutId = useRef<number | null>(null);\n\n  useEffect(() => {\n    if (show) {\n      timeoutId.current = window.setTimeout(() => {\n        onFadeout();\n        timeoutId.current = null;\n      }, timeout);\n    }\n\n    return () => {\n      if (timeoutId.current) {\n        clearTimeout(timeoutId.current);\n      }\n    };\n  }, [show]);\n\n  return (\n    <MaterialFade in={show}>\n      <div>{show ? children : null}</div>\n    </MaterialFade>\n  );\n}\n\nFade.defaultProps = {\n  timeout: 1000,\n};\n\nexport default Fade;\n","import { createSlice, PayloadAction, createAsyncThunk } from '@reduxjs/toolkit';\nimport yorkie, { Client, Document, Text, TimeTicket } from 'yorkie-js-sdk';\nimport anonymous from 'anonymous-animals-gen';\nimport randomColor from 'randomcolor';\nimport { Presence } from 'features/peerSlices';\n\nexport enum Preview {\n  HTML = 'html',\n  Slide = 'slide',\n}\n\nexport enum CodeMode {\n  Markdown = 'gfm',\n  Go = 'go',\n  JavaScript = 'javascript',\n  Clojure = 'clojure',\n  Dart = 'dart',\n  Python = 'python',\n  Ruby = 'ruby',\n  Rust = 'rust',\n}\n\nexport type Point = {\n  y: number;\n  x: number;\n};\n\nexport interface Box {\n  y: number;\n  x: number;\n  width: number;\n  height: number;\n}\n\n// TODO(ppeeou): refer to yorkie-sdk-js ArrayProxy\nexport interface BaseShape {\n  type: string;\n  getID(): TimeTicket;\n}\n\nexport interface Line extends BaseShape {\n  type: 'line';\n  color: string;\n  points: Array<Point>;\n}\n\nexport interface EraserLine extends BaseShape {\n  type: 'eraser';\n  points: Array<Point>;\n}\n\nexport interface Rect extends BaseShape {\n  type: 'rect';\n  color: string;\n  points: Array<Point>;\n  box: Box;\n}\n\nexport type Shape = Line | EraserLine | Rect;\n\nexport type ShapeType = Shape['type'];\n\nexport type CodePairDoc = {\n  mode: CodeMode;\n  preview: Preview;\n  content: Text;\n  shapes: Array<Shape>;\n};\n\n// TODO(ppeeou): refer to yorkie-sdk-js ArrayProxy\nexport interface Shapes {\n  push(shape: Shape): number;\n\n  getLast(): Shape;\n  getElementByID(createdAt: TimeTicket): Shape;\n  deleteByID(createdAt: TimeTicket): Shape;\n  length: number;\n  [index: number]: Shape;\n  [Symbol.iterator](): IterableIterator<Shape>;\n}\n\n//  TODO(ppeeou) refer to yorkie-sdk-js JSONObject\nexport interface Root {\n  shapes: Shapes & Array<Shape>;\n}\n\nexport enum DocStatus {\n  Disconnect = 'disconnect',\n  Connect = 'connect',\n}\n\nexport interface DocState {\n  client?: Client<Presence>;\n  doc?: Document<CodePairDoc>;\n  mode: CodeMode;\n  preview: Preview;\n  loading: boolean;\n  errorMessage: string;\n  status: DocStatus;\n}\n\nconst initialState: DocState = {\n  mode: CodeMode.Markdown,\n  preview: Preview.HTML,\n  loading: true,\n  errorMessage: '',\n  status: DocStatus.Connect,\n};\n\nexport const activateClient = createAsyncThunk<ActivateClientResult, undefined, { rejectValue: string }>(\n  'doc/activate',\n  async (_: undefined, thunkApi) => {\n    try {\n      const { name, animal } = anonymous.generate();\n      const options = {\n        apiKey: '',\n        presence: {\n          username: name,\n          image: animal,\n          color: randomColor(),\n          board: '',\n        },\n      };\n\n      if (`${process.env.REACT_APP_YORKIE_API_KEY}`) {\n        options.apiKey = `${process.env.REACT_APP_YORKIE_API_KEY}`;\n      }\n\n      const client = new yorkie.Client(`${process.env.REACT_APP_YORKIE_RPC_ADDR}`, options);\n\n      await client.activate();\n      return { client };\n    } catch (err) {\n      return thunkApi.rejectWithValue((err as Error).message);\n    }\n  },\n);\n\nexport const attachDoc = createAsyncThunk<AttachDocResult, AttachDocArgs, { rejectValue: string }>(\n  'doc/attach',\n  async ({ client, doc }, thunkApi) => {\n    try {\n      await client.attach(doc);\n\n      doc.update((root) => {\n        // codeEditor\n        if (!root.content) {\n          root.content = new yorkie.Text();\n        }\n        // board\n        if (!root.shapes) {\n          root.shapes = [];\n        }\n      });\n      await client.sync();\n      return { doc, client };\n    } catch (err) {\n      return thunkApi.rejectWithValue((err as Error).message);\n    }\n  },\n);\n\nconst docSlice = createSlice({\n  name: 'doc',\n  initialState,\n  reducers: {\n    deactivateClient(state) {\n      const { client } = state;\n      state.client = undefined;\n      client?.deactivate();\n    },\n    createDocument(state, action: PayloadAction<string>) {\n      state.doc = new yorkie.Document<CodePairDoc>(`codepairs-${action.payload}`);\n    },\n    detachDocument(state) {\n      const { doc, client } = state;\n      state.doc = undefined;\n      client?.detach(doc as Document<CodePairDoc>);\n    },\n    attachDocLoading(state, action: PayloadAction<boolean>) {\n      state.loading = action.payload;\n    },\n    setCodeMode(state, action: PayloadAction<CodeMode>) {\n      state.mode = action.payload;\n    },\n    setPreview(state, action: PayloadAction<Preview>) {\n      state.preview = action.payload;\n    },\n    setStatus(state, action: PayloadAction<DocStatus>) {\n      state.status = action.payload;\n    },\n  },\n  extraReducers: (builder) => {\n    builder.addCase(activateClient.fulfilled, (state, { payload }) => {\n      state.client = payload.client;\n    });\n    builder.addCase(activateClient.rejected, (state, { payload }) => {\n      state.errorMessage = payload!;\n    });\n    builder.addCase(attachDoc.fulfilled, (state, { payload }) => {\n      state.doc = payload.doc;\n      state.client = payload.client;\n    });\n    builder.addCase(attachDoc.rejected, (state, { payload }) => {\n      state.errorMessage = payload!;\n    });\n  },\n});\n\nexport const {\n  deactivateClient,\n  createDocument,\n  detachDocument,\n  attachDocLoading,\n  setPreview,\n  setCodeMode,\n  setStatus,\n} = docSlice.actions;\nexport default docSlice.reducer;\n\ntype ActivateClientResult = { client: Client<Presence> };\ntype AttachDocArgs = { doc: Document<CodePairDoc>; client: Client<Presence> };\ntype AttachDocResult = { doc: Document<CodePairDoc>; client: Client<Presence> };\n","import React, { useState, useCallback, useRef } from 'react';\nimport { useSelector } from 'react-redux';\nimport { CopyToClipboard } from 'react-copy-to-clipboard';\nimport Typography from '@material-ui/core/Typography';\nimport Box from '@material-ui/core/Box';\nimport Button from '@material-ui/core/Button';\nimport IconButton from '@material-ui/core/IconButton';\nimport GroupIcon from '@material-ui/icons/Group';\nimport FileCopyIcon from '@material-ui/icons/FileCopy';\nimport { makeStyles } from '@material-ui/core/styles';\n\nimport Dialog, { DialogTitle, DialogContent, DialogActions, DialogContentText } from 'components/commons/Dialog';\nimport Fade from 'components/commons/Fade';\nimport { AppState } from 'app/rootReducer';\nimport { DocStatus } from 'features/docSlices';\n\nconst useStyles = makeStyles(() => ({\n  dialog: {\n    borderRadius: '4px',\n  },\n  input: {\n    width: '300px',\n    padding: '12px 8px',\n    fontSize: '18px',\n    borderRadius: '5px',\n    outline: 'none',\n    backgroundColor: 'hsla(0,0%,100%,0.9)',\n  },\n  box: {\n    '@media only screen and (max-width: 600px)': {\n      display: 'none',\n    },\n  },\n  button: {\n    lineHeight: '32px',\n  },\n}));\n\nexport default function ShareButton() {\n  const classes = useStyles();\n  const status = useSelector((state: AppState) => state.docState.status);\n  const [open, setOpen] = useState(false);\n  const [showCopyText, setShowCopyText] = useState(false);\n  const inputRef = useRef<HTMLInputElement>(null);\n  const copyUrl = window.location.href.split('?')[0];\n\n  const onFocus = useCallback(() => {\n    inputRef.current?.select();\n  }, []);\n\n  const onCopy = useCallback(() => {\n    setShowCopyText(true);\n  }, []);\n\n  const openModal = useCallback(() => {\n    setOpen(true);\n  }, []);\n\n  const closeModal = useCallback(() => {\n    setOpen(false);\n  }, []);\n\n  return (\n    <div className={classes.box}>\n      <Button\n        className={classes.button}\n        size=\"small\"\n        color=\"primary\"\n        variant=\"contained\"\n        startIcon={<GroupIcon />}\n        onClick={openModal}\n        disabled={status === DocStatus.Disconnect}\n      >\n        Share\n      </Button>\n      <Dialog open={open} onClose={closeModal} className={classes.dialog}>\n        <DialogTitle onClose={closeModal}>Share Code</DialogTitle>\n        <DialogContent dividers>\n          <Box my={3}>\n            <Typography>Anyone can access the code in real time through this URL.</Typography>\n          </Box>\n          <Box my={1}>\n            <DialogContentText>Share this URL</DialogContentText>\n          </Box>\n          <Box display=\"flex\">\n            <input readOnly ref={inputRef} className={classes.input} value={copyUrl} onFocus={onFocus} />\n            <CopyToClipboard text={copyUrl} onCopy={onCopy}>\n              <IconButton color=\"primary\">\n                <FileCopyIcon />\n              </IconButton>\n            </CopyToClipboard>\n            <Fade show={showCopyText} onFadeout={() => setShowCopyText(false)}>\n              <p>Copy!</p>\n            </Fade>\n          </Box>\n        </DialogContent>\n        <DialogActions>\n          <Button onClick={closeModal} color=\"primary\" variant=\"contained\" autoFocus>\n            Close\n          </Button>\n        </DialogActions>\n      </Dialog>\n    </div>\n  );\n}\n","import React, { useState, useCallback, MouseEvent } from 'react';\nimport { useSelector } from 'react-redux';\nimport Box from '@material-ui/core/Box';\nimport Button from '@material-ui/core/Button';\nimport Typography from '@material-ui/core/Typography';\nimport CloudDoneIcon from '@material-ui/icons/CloudDone';\nimport CloudOffIcon from '@material-ui/icons/CloudOff';\nimport { createStyles, makeStyles } from '@material-ui/core/styles';\n\nimport Popover from 'components/commons/Popover';\nimport { AppState } from 'app/rootReducer';\nimport { DocStatus } from 'features/docSlices';\n\ninterface NetworkAlertProps {\n  title: string;\n  subTitle: string;\n  content: string;\n}\n\nconst useStyles = makeStyles(() =>\n  createStyles({\n    root: {\n      width: '380px',\n    },\n    title: {\n      backgroundColor: 'hsla(0,0%,100%,0.1)',\n      '& > *': {\n        fontWeight: 'bold',\n      },\n    },\n  }),\n);\n\nfunction NetworkAlert({ title, subTitle, content }: NetworkAlertProps) {\n  const classes = useStyles();\n\n  return (\n    <div className={classes.root}>\n      <Box px={2} py={1.5} className={classes.title}>\n        <Typography variant=\"subtitle1\">{title}</Typography>\n      </Box>\n      <Box px={2} p={1}>\n        <Box py={1}>\n          <Typography variant=\"body1\">{subTitle}</Typography>\n        </Box>\n\n        <Box pb={2.5}>\n          <Typography variant=\"body2\">{content}</Typography>\n        </Box>\n      </Box>\n    </div>\n  );\n}\n\nfunction NetworkDisconnect(props: { hasLocalChanges: boolean }) {\n  const [anchorEl, setAnchorEl] = useState<HTMLButtonElement | undefined>();\n  const { hasLocalChanges } = props;\n  const handleOpen = useCallback((event: MouseEvent<HTMLButtonElement>) => {\n    setAnchorEl(event.currentTarget);\n  }, []);\n\n  const handleClose = useCallback(() => {\n    setAnchorEl(undefined);\n  }, []);\n\n  return (\n    <>\n      <Button aria-label=\"doc-status\" color=\"secondary\" startIcon={<CloudOffIcon />} onClick={handleOpen}>\n        Working offline\n      </Button>\n\n      <Popover\n        anchorEl={anchorEl}\n        onClose={handleClose}\n        anchorOrigin={{\n          vertical: 'bottom',\n          horizontal: 'left',\n        }}\n        transformOrigin={{\n          vertical: 'top',\n          horizontal: 'left',\n        }}\n      >\n        <NetworkAlert\n          title={hasLocalChanges ? \"There are changes that couldn't be sent to Server\" : 'All Changes saved to Server'}\n          subTitle=\"This document is ready for offline use\"\n          content=\"Looks like you're offline. Changes will save to this memory now, and save to Server once reconnected.\"\n        />\n      </Popover>\n    </>\n  );\n}\n\nfunction NetworkConnect() {\n  const [anchorEl, setAnchorEl] = useState<HTMLButtonElement | undefined>();\n  const handleOpen = useCallback((event: MouseEvent<HTMLButtonElement>) => {\n    setAnchorEl(event.currentTarget);\n  }, []);\n\n  const handleClose = useCallback(() => {\n    setAnchorEl(undefined);\n  }, []);\n\n  return (\n    <>\n      <Button aria-label=\"doc-status\" color=\"secondary\" onClick={handleOpen}>\n        <CloudDoneIcon />\n      </Button>\n\n      <Popover\n        anchorEl={anchorEl}\n        onClose={handleClose}\n        anchorOrigin={{\n          vertical: 'bottom',\n          horizontal: 'left',\n        }}\n        transformOrigin={{\n          vertical: 'top',\n          horizontal: 'left',\n        }}\n      >\n        <NetworkAlert\n          title=\"All Changes saved to Server\"\n          subTitle=\"This document is ready for offline use\"\n          content=\"You can edit this document without an internet connection. Changes will save to Server once reconnected.\"\n        />\n      </Popover>\n    </>\n  );\n}\n\nexport default function NetworkButton() {\n  const status = useSelector((state: AppState) => state.docState.status);\n  const hasLocalChanges = useSelector((state: AppState) => {\n    return state.docState.doc ? state.docState.doc.hasLocalChanges() : false;\n  });\n\n  if (status === DocStatus.Connect) {\n    return <NetworkConnect />;\n  }\n  return <NetworkDisconnect hasLocalChanges={hasLocalChanges} />;\n}\n","import React, { memo } from 'react';\nimport { Link } from '@material-ui/core';\nimport { createStyles, makeStyles, Theme } from '@material-ui/core/styles';\nimport AppBar from '@material-ui/core/AppBar';\nimport Toolbar from '@material-ui/core/Toolbar';\nimport Typography from '@material-ui/core/Typography';\nimport PeerGroup from 'components/NavBar/PeerGroup';\nimport ShareButton from 'components/NavBar/ShareButton';\nimport NetworkButton from 'components/NavBar/NetworkButton';\n\nconst useStyles = makeStyles((theme: Theme) =>\n  createStyles({\n    root: {\n      flexGrow: 1,\n    },\n    appBar: {\n      backgroundColor: 'black',\n    },\n    grow: {\n      flexGrow: 1,\n    },\n    title: {\n      fontWeight: 'bold',\n      color: theme.palette.primary.main,\n      marginRight: theme.spacing(1),\n    },\n    yorkie: {\n      '& > a': {\n        textDecoration: 'none',\n        color: '#b5b0a1',\n        fontSize: 12,\n      },\n    },\n    items: {\n      display: 'flex',\n      '& > *': {\n        margin: theme.spacing(1),\n      },\n    },\n  }),\n);\n\nfunction MenuAppBar() {\n  const classes = useStyles();\n\n  return (\n    <div className={classes.root}>\n      <AppBar position=\"static\" className={classes.appBar}>\n        <Toolbar>\n          <Typography variant=\"h6\" className={classes.title}>\n            <Link href=\"/\" underline=\"none\">\n              CodePair\n            </Link>\n          </Typography>\n          <Typography className={classes.yorkie}>\n            <a href=\"https://yorkie.dev\" target=\"_blank\" rel=\"noreferrer\">\n              Powered by Yorkie\n            </a>\n          </Typography>\n          <NetworkButton />\n          <div className={classes.grow} />\n          <div className={classes.items}>\n            <ShareButton />\n            <PeerGroup />\n          </div>\n        </Toolbar>\n      </AppBar>\n    </div>\n  );\n}\n\nexport default memo(MenuAppBar);\n","import { ActorID } from 'yorkie-js-sdk';\nimport invert from 'invert-color';\nimport { Presence } from 'features/peerSlices';\n\nenum CursorStatus {\n  Deactivated = 'deactivated',\n  Activated = 'activated',\n}\n\n// REF https://github.com/FujitsuLaboratories/cattaz/blob/master/src/AppEnabledWikiEditorCodeMirror.jsx#L24\nexport default class Cursor {\n  private id: ActorID;\n\n  private username: string;\n\n  private color: string;\n\n  private height: number;\n\n  private marker?: CodeMirror.TextMarker;\n\n  private lineMarker?: CodeMirror.TextMarker;\n\n  private status: CursorStatus;\n\n  private nameRemoveTimeMap: Map<ActorID, ReturnType<typeof setTimeout>>;\n\n  private nameAnimationDelay: number;\n\n  private nameAnimationDuration: number;\n\n  private nameRemoveTime: number;\n\n  constructor(id: ActorID, presence: Presence) {\n    this.id = id;\n    this.username = presence.username;\n    this.color = presence.color;\n    this.height = 0;\n    this.status = CursorStatus.Deactivated;\n\n    this.nameRemoveTimeMap = new Map();\n    this.nameAnimationDelay = 1;\n    this.nameAnimationDuration = 0.2;\n    this.nameRemoveTime = (this.nameAnimationDuration + this.nameAnimationDelay) * 1000;\n  }\n\n  updateCursor(cm: CodeMirror.Editor, cursorPos: CodeMirror.Position) {\n    this.removeCursor();\n    this.status = CursorStatus.Activated;\n    const cursorCoords = cm.cursorCoords(cursorPos);\n    const cursorHolder = document.createElement('span');\n    this.height = cursorCoords.bottom - cursorCoords.top;\n\n    cursorHolder.classList.add('codePair-cursor');\n    cursorHolder.style.borderLeftColor = this.color;\n    cursorHolder.style.height = `${this.height}px`;\n\n    this.marker = cm.setBookmark(cursorPos, {\n      widget: cursorHolder,\n      insertLeft: true,\n    });\n\n    this.showCursorNameReserve(cursorHolder);\n  }\n\n  updateLine(cm: CodeMirror.Editor, fromPos: CodeMirror.Position, toPos: CodeMirror.Position) {\n    this.removeLine();\n    this.status = CursorStatus.Activated;\n    // Apply transparency to the background of selection.\n    const redColor = parseInt(this.color.slice(1, 3), 16);\n    const greenColor = parseInt(this.color.slice(3, 5), 16);\n    const blueColor = parseInt(this.color.slice(5, 7), 16);\n    const backgroundColor = `rgba(${redColor}, ${greenColor}, ${blueColor}, 0.15)`;\n\n    this.lineMarker = cm.getDoc().markText(fromPos, toPos, {\n      css: `background-color : ${backgroundColor};`,\n    });\n  }\n\n  // when user's cursor hover, show name\n  private showCursorNameReserve(cursorHolder: Element) {\n    const nameHolder = document.createElement('span');\n    nameHolder.classList.add('codePair-name');\n\n    cursorHolder.addEventListener('mouseenter', () => {\n      if (this.nameRemoveTimeMap.has(this.id)) {\n        clearTimeout(this.nameRemoveTimeMap.get(this.id)!);\n      }\n\n      nameHolder.textContent = this.username;\n      nameHolder.style.top = `-${this.height}px`;\n      nameHolder.style.backgroundColor = this.color;\n      nameHolder.style.color = invert(this.color, true);\n\n      /**\n       * nameEl is being reused.\n       * In order to keep the name visible while the mouse is hovering,\n       * It need to delete the css class containing animation when it is mouseenter and add it when it is mouseleave.\n       */\n      nameHolder.classList.remove('text-remove');\n      cursorHolder.appendChild(nameHolder);\n    });\n\n    cursorHolder.addEventListener('mouseleave', () => {\n      nameHolder.classList.add('text-remove');\n      nameHolder.style.animationDuration = `${this.nameAnimationDuration}s`;\n      nameHolder.style.animationDelay = `${this.nameAnimationDelay}s`;\n\n      this.removeNameReserve(nameHolder);\n    });\n  }\n\n  // After animate, It should actually be deleted it.\n  private removeNameReserve(nameHolder: HTMLSpanElement) {\n    const timeoutId = setTimeout(() => {\n      nameHolder.parentNode!.removeChild(nameHolder);\n      this.nameRemoveTimeMap.delete(this.id);\n    }, this.nameRemoveTime);\n\n    this.nameRemoveTimeMap.set(this.id, timeoutId);\n  }\n\n  removeCursor() {\n    if (this.marker) {\n      this.marker.clear();\n      this.marker = undefined;\n    }\n  }\n\n  removeLine() {\n    if (this.lineMarker) {\n      this.lineMarker.clear();\n      this.lineMarker = undefined;\n    }\n  }\n\n  clear() {\n    this.removeCursor();\n    this.removeLine();\n  }\n\n  isActive() {\n    return this.status === CursorStatus.Activated;\n  }\n}\n","import { Marpit, RenderResult } from '@marp-team/marpit';\n\nexport default class SlideView {\n  marpit: Marpit;\n\n  theme: string;\n\n  constructor(theme: string) {\n    this.marpit = new Marpit({\n      inlineSVG: true,\n    });\n    this.theme = theme;\n\n    const slideTheme = `\n    /* @theme example */\n      section {\n      background-color: #000;\n      color: #fff;\n      font-size: 30px;\n      padding: 40px;\n      margin: 10px;\n      border: 10px solid black;\n    }\n\n    h1, h2 {\n      text-align: center;\n      margin: 0;\n    }\n\n    h1 {\n      color: #fff;\n    }\n    `;\n    this.marpit.themeSet.default = this.marpit.themeSet.add(slideTheme);\n  }\n\n  public render(markdown: string): RenderResult {\n    return this.marpit.render(markdown);\n  }\n}\n","import CodeMirror from 'codemirror';\n\n// @ts-ignore-start\nCodeMirror.Vim.defineEx('shuffle', 'shuf', (cm, params) => {\n  const lineStart = params.line || cm.firstLine();\n  const lineEnd = params.lineEnd || params.line || cm.lastLine();\n  if (lineStart === lineEnd) {\n    return;\n  }\n  const curStart = new CodeMirror.Pos(lineStart, 0);\n  const curEnd = new CodeMirror.Pos(lineEnd, cm.getLine(lineEnd).length);\n  const text = cm.getRange(curStart, curEnd).split('\\n');\n  for (let i = text.length - 1; i > 0; i -= 1) {\n    const j = Math.floor(Math.random() * (i + 1));\n    [text[i], text[j]] = [text[j], text[i]];\n  }\n  cm.replaceRange(text.join('\\n'), curStart, curEnd);\n});\n// @ts-ignore-end\n","import React, { useEffect, useMemo, useRef, useCallback, useState } from 'react';\nimport { createStyles, makeStyles, Theme } from '@material-ui/core/styles';\nimport { useSelector } from 'react-redux';\nimport { ActorID, DocEvent, TextChange } from 'yorkie-js-sdk';\nimport CodeMirror from 'codemirror';\nimport SimpleMDE from 'easymde';\nimport SimpleMDEReact from 'react-simplemde-editor';\n\nimport { AppState } from 'app/rootReducer';\nimport { ConnectionStatus, Presence } from 'features/peerSlices';\nimport { Theme as ThemeType } from 'features/settingSlices';\nimport { Preview } from 'features/docSlices';\n\nimport { NAVBAR_HEIGHT } from '../Editor';\nimport Cursor from './Cursor';\nimport SlideView from './slideView';\n\nimport 'easymde/dist/easymde.min.css';\nimport 'codemirror/keymap/sublime';\nimport 'codemirror/keymap/emacs';\nimport 'codemirror/keymap/vim';\nimport './codemirror/shuffle';\n\nconst WIDGET_HEIGHT = 70;\n\ninterface CodeEditorProps {\n  forwardedRef: React.MutableRefObject<CodeMirror.Editor | null>;\n}\n\ninterface Heading {\n  level: number;\n  text: string;\n  originalText?: string;\n}\n\nlet cachedTableOfContents: Heading[] = [];\n\nfunction generateTableOfContents(editorInstance: CodeMirror.Editor) {\n  const doc = editorInstance.getDoc();\n  const count = doc.lineCount();\n  const headings = [];\n\n  for (let i = 0; i < count; i += 1) {\n    const line = doc.getLine(i);\n    const match = line.match(/^(#+)\\s+(.*)/);\n    if (match) {\n      const level = match[1].length;\n      const text = match[2];\n      headings.push({ level, text, originalText: line });\n    }\n  }\n\n  const returnValue = {\n    isCached: true,\n    headings: [] as any[],\n  };\n\n  if (headings.length !== cachedTableOfContents.length) {\n    cachedTableOfContents = headings;\n    returnValue.headings = headings;\n    returnValue.isCached = false;\n    return returnValue;\n  }\n\n  if (headings.length > 0) {\n    for (let i = 0; i < headings.length; i += 1) {\n      if (headings[i].text !== cachedTableOfContents[i].text) {\n        cachedTableOfContents = headings;\n        returnValue.headings = headings;\n        returnValue.isCached = false;\n        break;\n      } else if (headings[i].level !== cachedTableOfContents[i].level) {\n        cachedTableOfContents = headings;\n        returnValue.headings = headings;\n        returnValue.isCached = false;\n        break;\n      }\n    }\n  }\n\n  return returnValue;\n}\n\nfunction displayTableOfContents(list: Heading[]) {\n  const toc = document.getElementById('tableOfContents');\n  if (toc) {\n    toc.innerHTML = `\n    <h3 style=\"padding: 5px 10px;margin:0px;\">\n      <button \n        class=\"close\" \n        style=\"font-size:20px;border:0px;background:transparent;cursor:pointer;float:right;\"\n      >&times;</button>\n    </h3>\n    <ul style=\"list-style-type: none;padding-left: 0px;padding: 10px;\">${list\n      .map((heading) => {\n        return `\n          <li class=\"level-${heading.level}\" \n              data-text=\"${heading.originalText}\" \n              style=\"padding-left: ${(heading.level - 1) * 10}px;margin-bottom: 5px;\"\n          >\n            <a href=\"#${encodeURIComponent(heading.originalText || '')}\" \n              style=\"text-decoration: none;color:black;\">${heading.text}</a>\n          </li>\n        `;\n      })\n      .join('')}</ul>`;\n  }\n}\n\nconst useStyles = makeStyles((theme: Theme) =>\n  createStyles({\n    dark: {\n      '& .CodeMirror': {\n        color: theme.palette.common.white,\n        borderColor: theme.palette.background.paper,\n        backgroundColor: theme.palette.background.paper,\n      },\n      '& .CodeMirror-cursor': {\n        borderLeftColor: theme.palette.common.white,\n        color: theme.palette.common.white,\n      },\n      '& .editor-toolbar': {\n        backgroundColor: '#303030',\n      },\n      '& .editor-toolbar > *': {\n        color: theme.palette.common.white,\n      },\n      '& .editor-toolbar > .active, .editor-toolbar > button:hover, .editor-preview pre, .cm-s-easymde': {\n        backgroundColor: theme.palette.background.paper,\n      },\n      '& .editor-preview': {\n        backgroundColor: theme.palette.background.default,\n      },\n\n      '& .CodeMirror-line span.cm-keyword': { color: '#f92672' },\n      '& .CodeMirror-line span.cm-atom': { color: '#ae81ff' },\n      '& .CodeMirror-line span.cm-number': { color: '#ae81ff' },\n      '& .CodeMirror-line span.cm-def': { color: '#bc9262' },\n      '& .CodeMirror-line span.cm-variable': { color: '#f8f8f2' },\n      '& .CodeMirror-line span.cm-property': { color: '#a6e22e' },\n      '& .CodeMirror-line span.cm-operator': { color: '#fff' },\n      '& .CodeMirror-line span.cm-string': { color: '#e6db74' },\n      '& .CodeMirror-line span.cm-string-2': { color: '#e6db74' },\n      '& .CodeMirror-line span.cm-meta': { color: '#555' },\n      '& .CodeMirror-line span.cm-error': { background: '#f92672', color: '#f8f8f0' },\n      '& .CodeMirror-line span.cm-qualifier': { color: '#555' },\n      '& .CodeMirror-line span.cm-builtin': { color: '#66d9ef' },\n      '& .CodeMirror-line span.cm-bracket': { color: '#f8f8f2' },\n      '& .CodeMirror-line span.cm-tag': { color: '#bc6283' },\n      '& .CodeMirror-line span.cm-attribute': { color: '#97b757' },\n      '& .CodeMirror-line span.cm-hr': { color: '#999' },\n    },\n  }),\n);\n\nexport default function CodeEditor({ forwardedRef }: CodeEditorProps) {\n  const classes = useStyles();\n\n  const doc = useSelector((state: AppState) => state.docState.doc);\n  const preview = useSelector((state: AppState) => state.docState.preview);\n  const menu = useSelector((state: AppState) => state.settingState.menu);\n  const client = useSelector((state: AppState) => state.docState.client);\n  const peers = useSelector((state: AppState) => state.peerState.peers);\n  const cursorMapRef = useRef<Map<ActorID, Cursor>>(new Map());\n  const [editor, setEditor] = useState<CodeMirror.Editor | null>(null);\n\n  const connectCursor = useCallback((clientID: ActorID, presence: Presence) => {\n    cursorMapRef.current.set(clientID, new Cursor(clientID, presence));\n  }, []);\n\n  const disconnectCursor = useCallback((clientID: ActorID) => {\n    if (cursorMapRef.current.has(clientID)) {\n      cursorMapRef.current.get(clientID)!.clear();\n      cursorMapRef.current.delete(clientID);\n    }\n  }, []);\n\n  const getCmInstanceCallback = useCallback((cm: CodeMirror.Editor) => {\n    setEditor(cm);\n  }, []);\n\n  const goHeadingLink = useCallback((cm: CodeMirror.Editor) => {\n    const searchText = decodeURIComponent(window.location.hash.replace('#', ''));\n    const cursor = (cm as any).getSearchCursor(searchText);\n\n    if (cursor.find()) {\n      cm.setCursor(cursor.from());\n      cm.scrollIntoView(cursor.from());\n    }\n  }, []);\n\n  const toggleTableOfContents = useCallback((cm) => {\n    const el = document.getElementById('tableOfContents');\n\n    if (el) {\n      const { display } = el.style;\n      el.style.display = display === 'none' ? 'block' : 'none';\n\n      if (el.style.display === 'block') {\n        if (cm) {\n          const toc = generateTableOfContents(cm);\n\n          if (toc.isCached === false) {\n            displayTableOfContents(toc.headings);\n          }\n        }\n      }\n    }\n  }, []);\n\n  useEffect(() => {\n    for (const [id, peer] of Object.entries(peers)) {\n      if (cursorMapRef.current.has(id) && peer.status === ConnectionStatus.Disconnected) {\n        disconnectCursor(id);\n      } else if (!cursorMapRef.current.has(id) && peer.status === ConnectionStatus.Connected) {\n        connectCursor(id, peer.presence);\n      }\n    }\n  }, [peers, connectCursor, disconnectCursor]);\n\n  useEffect(() => {\n    if (!client || !doc || !editor) {\n      return;\n    }\n\n    // eslint-disable-next-line no-param-reassign\n    forwardedRef.current = editor;\n\n    const updateCursor = (clientID: ActorID, pos: CodeMirror.Position) => {\n      const cursor = cursorMapRef.current.get(clientID);\n      cursor?.updateCursor(editor, pos);\n    };\n\n    const updateLine = (clientID: ActorID, fromPos: CodeMirror.Position, toPos: CodeMirror.Position) => {\n      const cursor = cursorMapRef.current.get(clientID);\n      cursor?.updateLine(editor, fromPos, toPos);\n    };\n\n    let syncText = () => {};\n\n    doc.subscribe((event: DocEvent) => {\n      if (event.type === 'remote-change') {\n        // display remote cursors\n        for (const { change } of event.value) {\n          const actor = change.getID().getActorID()!;\n          if (actor !== client.getID()) {\n            if (!cursorMapRef.current.has(actor)) {\n              return;\n            }\n\n            const cursor = cursorMapRef.current.get(actor);\n            if (cursor!.isActive()) {\n              return;\n            }\n\n            updateCursor(actor, editor.posFromIndex(0));\n          }\n        }\n      } else if (event.type === 'snapshot') {\n        // re-sync for the new text from the snapshot\n        syncText();\n      }\n    });\n\n    editor.on('mousedown', (instance: CodeMirror.Editor, event: MouseEvent) => {\n      if (event.metaKey) {\n        const pos = editor.coordsChar({ left: event.clientX, top: event.clientY });\n        const token = editor.getTokenAt(pos);\n\n        if (token.type?.includes('link')) {\n          window.open(token.string, token.string);\n        }\n      }\n    });\n\n    editor.on('change', (instance: CodeMirror.Editor) => {\n      const el = document.getElementById('tableOfContents');\n\n      // Don't fire unless tableOfContents is visible\n      if (el?.style.display !== 'block') return;\n\n      const toc = generateTableOfContents(instance);\n\n      if (toc.isCached === false) {\n        displayTableOfContents(toc.headings);\n      }\n    });\n\n    // local to remote\n    editor.on('beforeChange', (instance: CodeMirror.Editor, change: CodeMirror.EditorChange) => {\n      if (change.origin === 'yorkie' || change.origin === 'setValue') {\n        return;\n      }\n\n      const from = editor.indexFromPos(change.from);\n      const to = editor.indexFromPos(change.to);\n      const content = change.text.join('\\n');\n\n      doc.update((root) => {\n        root.content.edit(from, to, content);\n      });\n    });\n\n    editor.on('beforeSelectionChange', (instance: CodeMirror.Editor, data: CodeMirror.EditorSelectionChange) => {\n      if (!data.origin) {\n        return;\n      }\n\n      const from = editor.indexFromPos(data.ranges[0].anchor);\n      const to = editor.indexFromPos(data.ranges[0].head);\n\n      doc.update((root) => {\n        root.content.select(from, to);\n      });\n    });\n\n    // remote to local\n    const changeEventHandler = (changes: TextChange[]) => {\n      changes.forEach((change) => {\n        const { actor, from, to } = change;\n        if (change.type === 'content') {\n          const content = change.value?.content || '';\n          if (actor !== client.getID()) {\n            const fromPos = editor.posFromIndex(from);\n            const toPos = editor.posFromIndex(to);\n            editor.replaceRange(content, fromPos, toPos, 'yorkie');\n          }\n        } else if (change.type === 'selection') {\n          if (actor !== client.getID()) {\n            let fromPos = editor.posFromIndex(from);\n            let toPos = editor.posFromIndex(to);\n            updateCursor(actor, toPos);\n            if (from > to) {\n              [toPos, fromPos] = [fromPos, toPos];\n            }\n            updateLine(actor, fromPos, toPos);\n          }\n        }\n      });\n    };\n\n    // sync text of document and editor\n    syncText = () => {\n      const text = doc.getRoot().content;\n      text.onChanges(changeEventHandler);\n      editor.setValue(text.toString());\n    };\n    syncText();\n    editor.addKeyMap(menu.codeKeyMap);\n    editor.setOption('keyMap', menu.codeKeyMap);\n    editor.getDoc().clearHistory();\n    editor.focus();\n\n    const toc = generateTableOfContents(editor);\n\n    if (toc.isCached === false) {\n      displayTableOfContents(toc.headings);\n    }\n\n    const tableOfContents = document.getElementById('tableOfContents');\n\n    if (tableOfContents) {\n      tableOfContents.addEventListener('click', (event) => {\n        if ((event.target as any)?.classList.contains('close')) {\n          toggleTableOfContents(editor);\n        }\n      });\n    }\n\n    // set table of contents event\n    // When a hashchange event occurs, move inside the codemirror with location.hash.\n    window.addEventListener('hashchange', () => {\n      goHeadingLink(editor);\n    });\n\n    setTimeout(() => {\n      goHeadingLink(editor);\n    }, 1000);\n  }, [client, doc, editor, forwardedRef, menu, goHeadingLink, toggleTableOfContents]);\n\n  const options = useMemo(() => {\n    const opts = {\n      spellChecker: false,\n      placeholder: 'Write code here and share...',\n      tabSize: Number(menu.tabSize),\n      maxHeight: `calc(100vh - ${NAVBAR_HEIGHT + WIDGET_HEIGHT}px)`,\n      toolbar: [\n        'bold',\n        'italic',\n        '|',\n        'unordered-list',\n        'ordered-list',\n        '|',\n        'code',\n        'link',\n        'image',\n        'table',\n        '|',\n        {\n          name: 'table-of-contents',\n          action: ({ codemirror }) => {\n            toggleTableOfContents(codemirror);\n          },\n          className: 'fa fa-bars',\n          title: 'Table of Contents',\n        },\n        'side-by-side',\n        'preview',\n        'fullscreen',\n      ],\n      unorderedListStyle: '-',\n      status: false,\n      shortcuts: {\n        toggleUnorderedList: null,\n      },\n    } as SimpleMDE.Options;\n\n    if (preview === Preview.Slide) {\n      const slideView = new SlideView(menu.theme);\n      // eslint-disable-next-line func-names\n      opts.previewRender = function (markdown: string, previewElement: HTMLElement): string {\n        const { html, css } = slideView.render(markdown);\n        // @ts-ignore\n        const self = this as any;\n        setTimeout(() => {\n          if (!self.style) {\n            self.style = document.createElement('style');\n            document.head.appendChild(self.style);\n          }\n          self.style.innerHTML = css;\n\n          // eslint-disable-next-line no-param-reassign\n          previewElement.innerHTML = html;\n        }, 20);\n\n        // @ts-ignore\n        return null;\n      };\n    }\n    return opts;\n  }, [preview, menu, toggleTableOfContents]);\n\n  return (\n    <SimpleMDEReact\n      className={menu.theme === ThemeType.Dark ? classes.dark : ''}\n      getCodemirrorInstance={getCmInstanceCallback}\n      options={options}\n    />\n  );\n}\n","import { createSlice, PayloadAction } from '@reduxjs/toolkit';\n\nexport enum Color {\n  Red = '#d8453c',\n  Blue = '#19abbf',\n  Green = '#699e3d',\n  White = '#cccccc',\n  Yellow = '#f3b328',\n  Black = '#444',\n}\n\nexport enum ToolType {\n  None,\n  Line,\n  Eraser,\n  Rect,\n  Selector,\n  Clear,\n}\n\nexport interface BoardState {\n  isOpen: boolean;\n\n  color: Color;\n  toolType: ToolType;\n}\n\nconst initialBoardState: BoardState = {\n  isOpen: false,\n  color: Color.Yellow,\n  toolType: ToolType.None,\n};\n\nconst boardSlice = createSlice({\n  name: 'board',\n  initialState: initialBoardState,\n\n  reducers: {\n    toggleBoard(state) {\n      state.isOpen = !state.isOpen;\n    },\n\n    setTool(state, action: PayloadAction<ToolType>) {\n      state.toolType = action.payload;\n    },\n\n    setColor(state, action: PayloadAction<Color>) {\n      state.color = action.payload;\n    },\n  },\n});\n\nexport const { toggleBoard, setTool, setColor } = boardSlice.actions;\nexport default boardSlice.reducer;\n","/* eslint-disable max-classes-per-file */\nclass Event {\n  private name: string;\n\n  callbacks: Array<Function>;\n\n  constructor(name: string) {\n    this.name = name;\n    this.callbacks = [];\n  }\n\n  on(cb: Function) {\n    this.callbacks.push(cb);\n  }\n\n  off(cb: Function) {\n    const idx = this.callbacks.findIndex((callback) => callback === cb);\n    this.callbacks.splice(idx, 1);\n  }\n\n  toString() {\n    return this.name;\n  }\n}\n\nexport default class EventDispatcher {\n  events: { [name: string]: Event };\n\n  constructor() {\n    this.events = {};\n  }\n\n  emit(name: string, ...args: Array<unknown>) {\n    if (!this.events[name]) {\n      return;\n    }\n\n    this.events[name].callbacks.forEach((cb) => {\n      cb(...args);\n    });\n  }\n\n  addEventListener(name: string, cb: Function): void {\n    if (!this.events[name]) {\n      this.events[name] = new Event(name);\n    }\n\n    this.events[name].on(cb);\n  }\n\n  removeEventListener(name: string, cb?: Function) {\n    if (!cb) {\n      delete this.events[name];\n      return;\n    }\n\n    this.events[name].off(cb);\n  }\n}\n","export default class CanvasWrapper {\n  private canvas: HTMLCanvasElement;\n\n  // eslint-disable-next-line react/static-property-placement\n  private context: CanvasRenderingContext2D;\n\n  private width = 0;\n\n  private height = 0;\n\n  constructor(canvas: HTMLCanvasElement) {\n    this.canvas = canvas;\n    this.context = canvas.getContext('2d')!;\n\n    this.context.lineWidth = 3;\n    this.context.lineCap = 'round';\n    this.canvas.className = 'canvas';\n\n    this.setWidth(canvas.width);\n    this.setHeight(canvas.height);\n  }\n\n  getCanvas() {\n    return this.canvas;\n  }\n\n  getContext() {\n    return this.context;\n  }\n\n  getWidth() {\n    return this.width;\n  }\n\n  getHeight() {\n    return this.height;\n  }\n\n  setWidth(width: number, devicePixelRatio?: number) {\n    this.width = width;\n    this.canvas.width = devicePixelRatio ? width * devicePixelRatio : width;\n    this.canvas.style.width = `${width}px`;\n  }\n\n  setHeight(height: number, devicePixelRatio?: number) {\n    this.height = height;\n    this.canvas.height = devicePixelRatio ? height * devicePixelRatio : height;\n    this.canvas.style.height = `${height}px`;\n  }\n\n  setSize(width: number, height: number, devicePixelRatio?: number) {\n    this.setWidth(width, devicePixelRatio);\n    this.setHeight(height, devicePixelRatio);\n  }\n\n  clear() {\n    this.getContext().clearRect(0, 0, this.getWidth(), this.getHeight());\n  }\n\n  resize() {\n    const { devicePixelRatio } = window;\n    if (devicePixelRatio) {\n      this.setSize(this.width, this.height, devicePixelRatio);\n      this.context.scale(devicePixelRatio, devicePixelRatio);\n    } else {\n      this.setSize(this.width, this.height);\n    }\n  }\n}\n","import { Color } from 'features/boardSlices';\nimport fitCurve from 'fit-curve';\nimport { Line, Point, EraserLine } from 'features/docSlices';\n\ntype CanvasLine = Pick<Line, 'type' | 'points' | 'color'>;\n\ntype CanvasEraser = Pick<EraserLine, 'type' | 'points'>;\n\n/**\n * Create the basic object of the line with point.\n */\nexport function createLine(point: Point, color: Color): Line {\n  return {\n    type: 'line',\n    color,\n    points: [point],\n  } as Line;\n}\n\n/**\n * Create the basic object of the line with point.\n */\nexport function createEraserLine(point: Point): EraserLine {\n  return {\n    type: 'eraser',\n    points: [point],\n  } as EraserLine;\n}\n\n/**\n * drawTrace draws a trace of the line\n */\nexport function drawTrace(context: CanvasRenderingContext2D, line: CanvasLine) {\n  const { points, color } = line;\n  context.strokeStyle = color;\n  context.beginPath();\n  context.moveTo(points[0].x, points[0].y);\n  for (let i = 1; i < points.length; i += 1) {\n    context.lineTo(points[i].x, points[i].y);\n  }\n  context.stroke();\n}\n\n/**\n * drawLine draws a line with bezier curves.\n */\nexport function drawLine(context: CanvasRenderingContext2D, line: CanvasLine) {\n  if (line.points.length < 3) {\n    return;\n  }\n\n  const points = [];\n  for (const p of line.points) {\n    points.push([p.x, p.y]);\n  }\n\n  const curves = fitCurve(points, 2);\n  if (!curves.length) {\n    return;\n  }\n\n  context.save();\n  context.beginPath();\n  context.strokeStyle = line.color || '#ff7043';\n\n  const firstCurve = curves[0];\n  context.moveTo(firstCurve[0][0], firstCurve[0][1]);\n\n  for (const curve of curves) {\n    context.bezierCurveTo(curve[1][0], curve[1][1], curve[2][0], curve[2][1], curve[3][0], curve[3][1]);\n  }\n\n  context.stroke();\n  context.closePath();\n  context.restore();\n}\n\n/**\n * drawEraser draws the line of the eraser on the canvas.\n */\nexport function drawEraser(context: CanvasRenderingContext2D, line: CanvasEraser) {\n  context.save();\n  context.beginPath();\n\n  context.strokeStyle = '#ff7043';\n\n  let isMoved = false;\n  for (const p of line.points) {\n    if (isMoved === false) {\n      isMoved = true;\n      context.moveTo(p.x, p.y);\n    } else {\n      context.lineTo(p.x, p.y);\n    }\n  }\n  context.stroke();\n  context.closePath();\n  context.restore();\n}\n\n/**\n * Match the mouse point position for eraser\n */\nexport function fixEraserPoint(point: Point) {\n  const eraserOffsetXSize = 8;\n  const eraserOffsetYSize = 6;\n  return {\n    y: point.y + eraserOffsetXSize,\n    x: point.x + eraserOffsetYSize,\n  };\n}\n","import { Point, Box, Shape, Rect } from 'features/docSlices';\n\n/**\n * square distance between 2 points\n */\nfunction getSqDist(p1: Point, p2: Point) {\n  const dx = p1.x - p2.x;\n  const dy = p1.y - p2.y;\n\n  return dx * dx + dy * dy;\n}\n\n/**\n * square distance from a point to a segment\n */\nfunction getSqSegDist(p: Point, p1: Point, p2: Point) {\n  let { x, y } = p1;\n  let dx = p2.x - x;\n  let dy = p2.y - y;\n\n  if (dx !== 0 || dy !== 0) {\n    const t = ((p.x - x) * dx + (p.y - y) * dy) / (dx * dx + dy * dy);\n    if (t > 1) {\n      x = p2.x;\n      y = p2.y;\n    } else if (t > 0) {\n      x += dx * t;\n      y += dy * t;\n    }\n  }\n\n  dx = p.x - x;\n  dy = p.y - y;\n  return dx * dx + dy * dy;\n}\n\nfunction douglasPeuckerStep(\n  points: Array<Point>,\n  first: number,\n  last: number,\n  tolerance: number,\n  simplified: Array<Point>,\n) {\n  let maxDist = tolerance;\n  let index = 0;\n\n  for (let i = first + 1; i < last; i += 1) {\n    const dist = getSqSegDist(points[i], points[first], points[last]);\n\n    if (dist > maxDist) {\n      index = i;\n      maxDist = dist;\n    }\n  }\n\n  if (maxDist > tolerance) {\n    if (first + 1 < index) {\n      douglasPeuckerStep(points, first, index, tolerance, simplified);\n    }\n    simplified.push(points[index]);\n    if (index + 1 < last) {\n      douglasPeuckerStep(points, index, last, tolerance, simplified);\n    }\n  }\n}\n\nfunction douglasPeucker(points: Array<Point>, tolerance: number): Array<Point> {\n  const first = 0;\n  const last = points.length - 1;\n  const simplified = [];\n\n  simplified.push(points[first]);\n  douglasPeuckerStep(points, first, last, tolerance, simplified);\n  simplified.push(points[last]);\n\n  return simplified;\n}\n\nfunction simplifyRadialDist(points: Array<Point>, tolerance: number) {\n  let point = points[0];\n  let prevPoint = point;\n  const simplified = [prevPoint];\n\n  for (let i = 1, len = points.length; i < len; i += 1) {\n    point = points[i];\n\n    if (getSqDist(point, prevPoint) > tolerance) {\n      simplified.push(point);\n      prevPoint = point;\n    }\n  }\n\n  if (prevPoint !== point) {\n    simplified.push(point);\n  }\n  return simplified;\n}\n\n/**\n * @see {@link https://cartography-playground.gitlab.io/playgrounds/douglas-peucker-algorithm/}\n * @see {@link https://github.com/mourner/simplify-js}\n */\nexport function compressPoints(points: Array<Point>, tolerance: number = 10): Array<Point> {\n  return douglasPeucker(simplifyRadialDist(points, tolerance), tolerance);\n}\n\n/**\n * Check if the two lines overlap\n * @see {@link http://jsfiddle.net/justin_c_rounds/Gd2S2/}\n * @see {@link https://en.wikipedia.org/wiki/Line%E2%80%93line_intersection}\n */\nexport function checkLineIntersection(point1Start: Point, point1End: Point, point2Start: Point, point2End: Point) {\n  // if the lines intersect, the result contains the x and y of the intersection (treating the lines as infinite) and booleans for whether line segment 1 or line segment 2 contain the point\n  let a;\n  let b;\n  const result = {\n    x: 0,\n    y: 0,\n    onLine1: false,\n    onLine2: false,\n  };\n\n  const denominator =\n    (point2End.y - point2Start.y) * (point1End.x - point1Start.x) -\n    (point2End.x - point2Start.x) * (point1End.y - point1Start.y);\n  if (denominator === 0) {\n    return result;\n  }\n  a = point1Start.y - point2Start.y;\n  b = point1Start.x - point2Start.x;\n  const numerator1 = (point2End.x - point2Start.x) * a - (point2End.y - point2Start.y) * b;\n  const numerator2 = (point1End.x - point1Start.x) * a - (point1End.y - point1Start.y) * b;\n  a = numerator1 / denominator;\n  b = numerator2 / denominator;\n\n  // if we cast these lines infinitely in both directions, they intersect here:\n  result.x = point1Start.x + a * (point1End.x - point1Start.x);\n  result.y = point1Start.y + a * (point1End.y - point1Start.y);\n  /*\n  // it is worth noting that this should be the same as:\n  x = point2Start.x + (b * (point2End.x - point2Start.x));\n  y = point2Start.x + (b * (point2End.y - point2Start.y));\n  */\n  // if line1 is a segment and line2 is infinite, they intersect if:\n  if (a > 0 && a < 1) {\n    result.onLine1 = true;\n  }\n  // if line2 is a segment and line1 is infinite, they intersect if:\n  if (b > 0 && b < 1) {\n    result.onLine2 = true;\n  }\n  // if line1 and line2 are segments, they intersect if both of the above are true\n  return result;\n}\n\nexport function cloneBox(box: Box): Box {\n  return {\n    y: box.y,\n    x: box.x,\n    width: box.width,\n    height: box.height,\n  };\n}\n\n/**\n * Check if the point is contained inside the box.\n */\nexport function isInnerBox(box: Box, point: Point): boolean {\n  const offsetY = box.y + box.height;\n  const offsetX = box.x + box.width;\n\n  if (box.height > 0 ? offsetY < point.y : offsetY > point.y) {\n    return false;\n  }\n  if (box.y > point.y) {\n    return false;\n  }\n\n  if (box.height > 0 ? offsetX < point.x : offsetX > point.x) {\n    return false;\n  }\n  if (box.x > point.x) {\n    return false;\n  }\n  return true;\n}\n\n/**\n * Check if it is a shape that can be selected.\n */\nexport function isSelectable(shape: Shape): shape is Rect {\n  return shape.type === 'rect';\n}\n","import { Rect, Point, Box } from 'features/docSlices';\nimport { Color } from 'features/boardSlices';\nimport { cloneBox } from './utils';\n\nexport interface RectOptions {\n  color: Color;\n}\n\ntype CanvasRect = Pick<Rect, 'type' | 'color' | 'box'>;\n\n/**\n * Create the basic object of the rect with point.\n */\nexport function createRect(point: Point, options: RectOptions): Rect {\n  return {\n    type: 'rect',\n    color: options.color,\n    box: {\n      x: point.x,\n      y: point.y,\n      width: 0,\n      height: 0,\n    },\n    points: [{ x: point.x, y: point.y }],\n  } as Rect;\n}\n\n/**\n * Draw a rect on the canvas.\n */\nexport function drawRect(context: CanvasRenderingContext2D, rect: CanvasRect) {\n  context.save();\n  context.strokeStyle = rect.color;\n  context.strokeRect(rect.box.x, rect.box.y, rect.box.width, rect.box.height);\n  context.restore();\n}\n\n/**\n * Adjust the box according to the incoming point.\n */\nexport function adjustRectBox(shape: Rect, point: Point): Box {\n  const box = cloneBox(shape.box);\n  const rectPoint = shape.points[0];\n\n  const width = point.x - rectPoint.x;\n  const height = point.y - rectPoint.y;\n  const aWidth = Math.abs(width);\n  const aHeight = Math.abs(height);\n\n  box.x = rectPoint.x - (width > 0 ? 0 : -width);\n  box.y = rectPoint.y - (height > 0 ? 0 : -height);\n  box.width = aWidth;\n  box.height = aHeight;\n\n  return box;\n}\n","export function addEvent(el: EventTarget, type: string, fn: EventListener, capturing?: boolean) {\n  return el.addEventListener(type, fn, capturing);\n}\n\nexport function removeEvent(el: EventTarget, type: string, fn: EventListener, capturing?: boolean) {\n  return el.removeEventListener(type, fn, capturing);\n}\n\nconst touch = {\n  mouseup: 'touchend',\n  mouseout: 'touchend',\n  mousedown: 'touchstart',\n  mousemove: 'touchmove',\n};\n\ntype MouseType = 'mouseup' | 'mouseout' | 'mousedown' | 'mousemove';\n\nexport type TouchyEvent = MouseEvent & TouchEvent;\n\n/**\n * {@linkcode https://github.com/bevacqua/dragula/blob/e0bcdc72ae8e0b85e17f154957bdd0cc2e2e35db/dragula.js#L498}\n */\nexport function touchy(el: EventTarget, event: Function, type: MouseType, fn: (evt: TouchyEvent) => void) {\n  event(el, touch[type], fn);\n  event(el, type, fn);\n}\n","import { Point } from 'features/docSlices';\n\nexport type Task = Point;\n\nconst INTERVAL_TIME = 50;\nlet tasks: Array<Task> = [];\nlet timeout: ReturnType<typeof setTimeout>;\nlet work: Function | undefined;\n\nconst doWork = () => {\n  if (typeof work === 'function') {\n    work(tasks);\n    tasks = [];\n  }\n};\n\nfunction requestTask(isDone: Boolean) {\n  if (isDone) {\n    doWork();\n    return;\n  }\n\n  timeout = setTimeout(() => {\n    doWork();\n    requestTask(false);\n  }, INTERVAL_TIME);\n}\n\nexport function reserveTask(task: Task, _work: Function) {\n  tasks.push(task);\n\n  if (work === undefined) {\n    work = _work;\n    requestTask(false);\n  }\n}\n\nexport function flushTask() {\n  clearTimeout(timeout);\n\n  if (typeof work === 'function') {\n    requestTask(true);\n  }\n  work = undefined;\n}\n","import { TimeTicket } from 'yorkie-js-sdk';\nimport { ToolType, Color } from 'features/boardSlices';\nimport { Root, Shape, Point, Line, Rect } from 'features/docSlices';\n\nexport type Options = { color: Color };\n\nexport type BoardPresence = {\n  eraserPoints?: Point[];\n  line?: Omit<Line, 'getID'>;\n  rect?: Omit<Rect, 'getID'>;\n};\n\nexport type MouseDownCallback = (boardPresence: BoardPresence) => void;\n\nexport type MouseMoveCallback = (boardPresence: BoardPresence) => void;\n\nexport type MouseUpCallback = (boardPresence: BoardPresence) => void;\n\nabstract class Worker {\n  constructor(options?: Options) {\n    this.options = options;\n  }\n\n  options?: Options;\n\n  abstract type: ToolType;\n\n  abstract update: Function;\n\n  abstract mousedown(point: Point, callback?: MouseDownCallback): void;\n\n  abstract mousemove(point: Point, callback?: MouseMoveCallback): void;\n\n  abstract mouseup(callback?: MouseUpCallback): void;\n\n  abstract flushTask(): void;\n\n  getElementByID(root: Root, createID: TimeTicket): Shape | undefined {\n    return root.shapes.getElementByID(createID);\n  }\n\n  deleteByID(root: Root, createID: TimeTicket): Shape | undefined {\n    return root.shapes.deleteByID(createID);\n  }\n\n  clearAll() {\n    this.update((root: Root) => {\n      for (const shape of root.shapes) {\n        this.deleteByID(root, shape.getID());\n      }\n    });\n  }\n\n  setOption(options: Options) {\n    this.options = {\n      ...this.options,\n      ...options,\n    };\n  }\n}\n\nexport default Worker;\n","import { TimeTicket } from 'yorkie-js-sdk';\nimport { Root, Point, Line } from 'features/docSlices';\nimport { ToolType } from 'features/boardSlices';\nimport Board from 'components/Editor/DrawingBoard/Canvas/Board';\nimport { createLine } from '../line';\nimport Worker, { MouseMoveCallback, MouseUpCallback, Options } from './Worker';\nimport { compressPoints } from '../utils';\n\nclass LineWorker extends Worker {\n  type = ToolType.Line;\n\n  update: Function;\n\n  board: Board;\n\n  private createID?: TimeTicket;\n\n  private previewLine: Omit<Line, 'getID'>;\n\n  constructor(update: Function, board: Board, options: Options) {\n    super(options);\n    this.update = update;\n    this.board = board;\n    this.previewLine = {\n      type: 'line',\n      color: this.options!.color,\n      points: [],\n    };\n  }\n\n  mousedown(point: Point): void {\n    this.previewLine = createLine(point, this.options?.color!);\n  }\n\n  mousemove(point: Point, callback: MouseMoveCallback) {\n    this.previewLine.points.push(point);\n    callback({ line: { ...this.previewLine } });\n  }\n\n  mouseup(callback: MouseUpCallback) {\n    this.flushTask();\n    this.previewLine = { ...this.previewLine, points: [] };\n    callback({});\n  }\n\n  flushTask() {\n    if (this.previewLine.points.length > 0) {\n      this.update((root: Root) => {\n        this.previewLine.points = compressPoints(this.previewLine.points);\n        root.shapes.push(this.previewLine as Line);\n\n        const lastShape = root.shapes.getLast();\n        this.createID = lastShape.getID();\n        this.board.drawAll(root.shapes);\n      });\n    }\n  }\n}\n\nexport default LineWorker;\n","import { TimeTicket } from 'yorkie-js-sdk';\nimport { Root, Point, Rect } from 'features/docSlices';\nimport { ToolType } from 'features/boardSlices';\nimport Board from 'components/Editor/DrawingBoard/Canvas/Board';\nimport { createRect, adjustRectBox } from '../rect';\nimport Worker, { MouseMoveCallback, MouseUpCallback, Options } from './Worker';\n\nclass RectWorker extends Worker {\n  type = ToolType.Rect;\n\n  update: Function;\n\n  board: Board;\n\n  private createID?: TimeTicket;\n\n  private previewRect: Omit<Rect, 'getID'>;\n\n  constructor(update: Function, board: Board, options: Options) {\n    super(options);\n    this.update = update;\n    this.board = board;\n    this.previewRect = {\n      type: 'rect',\n      color: this.options!.color,\n      box: {\n        x: 0,\n        y: 0,\n        width: 0,\n        height: 0,\n      },\n      points: [],\n    };\n  }\n\n  mousedown(point: Point): void {\n    this.previewRect = createRect(point, this.options!);\n  }\n\n  mousemove(point: Point, callback: MouseMoveCallback) {\n    const box = adjustRectBox(this.previewRect as Rect, point);\n    this.previewRect.box = box;\n    callback({ rect: { ...this.previewRect } });\n  }\n\n  mouseup(callback: MouseUpCallback) {\n    this.flushTask();\n    this.previewRect = { ...this.previewRect, box: { x: 0, y: 0, height: 0, width: 0 }, points: [] };\n    callback({});\n  }\n\n  flushTask() {\n    if (this.previewRect.box.width !== 0 && this.previewRect.box.height !== 0) {\n      this.update((root: Root) => {\n        root.shapes.push(this.previewRect as Rect);\n\n        const lastShape = root.shapes.getLast();\n        this.createID = lastShape.getID();\n        this.board.drawAll(root.shapes);\n      });\n    }\n  }\n}\n\nexport default RectWorker;\n","import { ToolType, Color } from 'features/boardSlices';\nimport { Point, Shape } from 'features/docSlices';\nimport EventDispatcher from 'utils/eventDispatcher';\nimport { Presence } from 'features/peerSlices';\n\nimport CanvasWrapper from './CanvasWrapper';\nimport { drawLine, drawEraser, drawTrace } from './line';\nimport { drawRect } from './rect';\nimport { addEvent, removeEvent, touchy, TouchyEvent } from './dom';\nimport { Worker, NoneWorker, LineWorker, EraserWorker, RectWorker, SelectorWorker, BoardPresence } from './Worker';\n\nenum DragStatus {\n  Drag,\n  Stop,\n}\n\nexport default class Board extends EventDispatcher {\n  private offsetY: number = 0;\n\n  private offsetX: number = 0;\n\n  private color: Color = Color.Black;\n\n  private dragStatus: DragStatus = DragStatus.Stop;\n\n  private lowerWrapper: CanvasWrapper;\n\n  private upperWrapper: CanvasWrapper;\n\n  private presenceMap: Map<string, BoardPresence> = new Map();\n\n  update: Function;\n\n  worker!: Worker;\n\n  constructor(el: HTMLCanvasElement, update: Function) {\n    super();\n    this.lowerWrapper = new CanvasWrapper(el);\n    this.upperWrapper = this.createUpperWrapper();\n\n    this.update = update;\n\n    this.initialize();\n  }\n\n  initialize() {\n    this.initializeSize();\n    this.initializeOffset();\n    this.emit = this.emit.bind(this);\n    this.drawAll = this.drawAll.bind(this);\n    this.onMouseUp = this.onMouseUp.bind(this);\n    this.onMouseOut = this.onMouseOut.bind(this);\n    this.onMouseDown = this.onMouseDown.bind(this);\n    this.onMouseMove = this.onMouseMove.bind(this);\n\n    this.worker = new NoneWorker(this.update, this);\n\n    touchy(this.upperWrapper.getCanvas(), addEvent, 'mouseup', this.onMouseUp);\n    touchy(this.upperWrapper.getCanvas(), addEvent, 'mouseout', this.onMouseOut);\n    touchy(this.upperWrapper.getCanvas(), addEvent, 'mousedown', this.onMouseDown);\n\n    this.addEventListener('renderAll', this.drawAll);\n  }\n\n  destroy() {\n    touchy(this.upperWrapper.getCanvas(), removeEvent, 'mouseup', this.onMouseUp);\n    touchy(this.upperWrapper.getCanvas(), removeEvent, 'mouseout', this.onMouseOut);\n    touchy(this.upperWrapper.getCanvas(), removeEvent, 'mousedown', this.onMouseDown);\n\n    this.destroyUpperCanvas();\n    this.removeEventListener('renderAll');\n  }\n\n  initializeOffset() {\n    const { y, x } = this.lowerWrapper.getCanvas().getBoundingClientRect();\n    this.offsetY = y;\n    this.offsetX = x;\n  }\n\n  initializeSize() {\n    this.lowerWrapper.resize();\n    this.upperWrapper.resize();\n  }\n\n  createUpperWrapper(): CanvasWrapper {\n    const canvas = document.createElement('canvas');\n    const wrapper = new CanvasWrapper(canvas);\n\n    wrapper.setWidth(this.lowerWrapper.getWidth());\n    wrapper.setHeight(this.lowerWrapper.getHeight());\n\n    this.lowerWrapper.getCanvas().parentNode?.appendChild(canvas);\n\n    return wrapper;\n  }\n\n  destroyUpperCanvas() {\n    const upperCanvas = this.upperWrapper?.getCanvas();\n\n    if (upperCanvas) {\n      upperCanvas.parentNode?.removeChild(upperCanvas);\n    }\n  }\n\n  setColor(color: Color) {\n    this.color = color;\n    this.worker.setOption({ color });\n  }\n\n  setWidth(width: number) {\n    this.lowerWrapper.setWidth(width);\n    this.upperWrapper.setWidth(width);\n    this.resize();\n  }\n\n  setHeight(height: number) {\n    this.lowerWrapper.setHeight(height);\n    this.upperWrapper.setHeight(height);\n    this.resize();\n  }\n\n  resize() {\n    this.lowerWrapper.resize();\n    this.upperWrapper.resize();\n  }\n\n  setTool(tool: ToolType) {\n    this.setMouseClass(tool);\n\n    if (this.worker.type === tool) {\n      return;\n    }\n\n    this.worker.flushTask();\n    this.worker = this.createWorker(tool);\n  }\n\n  createWorker(tool: ToolType) {\n    if (tool === ToolType.Line) {\n      return new LineWorker(this.update, this, { color: this.color });\n    }\n    if (tool === ToolType.Eraser) {\n      return new EraserWorker(this.update, this);\n    }\n    if (tool === ToolType.Rect) {\n      return new RectWorker(this.update, this, { color: this.color });\n    }\n    if (tool === ToolType.Selector) {\n      return new SelectorWorker(this.update, this);\n    }\n    if (tool === ToolType.None || tool === ToolType.Clear) {\n      return new NoneWorker(this.update, this);\n    }\n    throw new TypeError(`Undefined tool: ${tool}`);\n  }\n\n  setMouseClass(tool: ToolType) {\n    this.upperWrapper.getCanvas().className = 'canvas canvas-upper';\n\n    if (tool === ToolType.Line || tool === ToolType.Rect) {\n      this.upperWrapper.getCanvas().classList.add('crosshair', 'canvas-touch-none');\n    } else if (tool === ToolType.Eraser) {\n      this.upperWrapper.getCanvas().classList.add('eraser', 'canvas-touch-none');\n    } else if (tool === ToolType.Selector) {\n      this.upperWrapper.getCanvas().classList.add('canvas-touch-none');\n    }\n  }\n\n  getPointFromTouchyEvent(evt: TouchyEvent): Point {\n    let originY;\n    let originX;\n    if (window.TouchEvent && evt instanceof TouchEvent) {\n      originY = evt.touches[0].clientY;\n      originX = evt.touches[0].clientX;\n    } else {\n      originY = evt.clientY;\n      originX = evt.clientX;\n    }\n    originY += window.scrollY;\n    originX += window.scrollX;\n    return {\n      y: originY - this.offsetY,\n      x: originX - this.offsetX,\n    };\n  }\n\n  onMouseDown(evt: TouchyEvent) {\n    touchy(this.upperWrapper.getCanvas(), addEvent, 'mousemove', this.onMouseMove);\n    this.dragStatus = DragStatus.Drag;\n\n    const point = this.getPointFromTouchyEvent(evt);\n\n    this.worker.mousedown(point, (boardPresence: BoardPresence) => {\n      this.emit('mousedown', boardPresence);\n    });\n  }\n\n  onMouseMove(evt: TouchyEvent) {\n    const point = this.getPointFromTouchyEvent(evt);\n    if (this.isOutside(point)) {\n      this.onMouseUp();\n      return;\n    }\n\n    if (this.dragStatus === DragStatus.Stop) {\n      return;\n    }\n\n    this.worker.mousemove(point, (boardPresence: BoardPresence) => {\n      this.emit('mousemove', boardPresence);\n    });\n  }\n\n  onMouseUp() {\n    touchy(this.upperWrapper.getCanvas(), removeEvent, 'mousemove', this.onMouseMove);\n    this.dragStatus = DragStatus.Stop;\n\n    this.worker.mouseup((boardPresence: BoardPresence) => {\n      this.emit('mousedown', boardPresence);\n    });\n    this.emit('mouseup');\n  }\n\n  onMouseOut() {\n    this.dragStatus = DragStatus.Stop;\n    this.worker.flushTask();\n    this.emit('mouseout');\n  }\n\n  updatePresence(peerKey: string, presence: Presence) {\n    this.clear(this.upperWrapper);\n\n    this.presenceMap.set(peerKey, JSON.parse(presence.board || '{}'));\n\n    for (const boardPresence of this.presenceMap.values()) {\n      const { eraserPoints, line, rect } = boardPresence;\n      if (eraserPoints && eraserPoints.length > 0) {\n        drawEraser(this.upperWrapper.getContext(), {\n          type: 'eraser',\n          points: eraserPoints,\n        });\n      }\n      if (line && line.points.length > 0) {\n        drawTrace(this.upperWrapper.getContext(), line);\n      }\n      if (rect && rect.box.height !== 0 && rect.box.width !== 0) {\n        drawRect(this.upperWrapper.getContext(), rect);\n      }\n    }\n  }\n\n  isOutside(point: Point): boolean {\n    if (\n      point.y < 0 ||\n      point.x < 0 ||\n      point.y > this.lowerWrapper.getHeight() ||\n      point.x > this.lowerWrapper.getWidth()\n    ) {\n      return true;\n    }\n    return false;\n  }\n\n  drawAll(shapes: Array<Shape>, wrapper: CanvasWrapper = this.lowerWrapper) {\n    this.clear(wrapper);\n    for (const shape of shapes) {\n      if (shape.type === 'line') {\n        drawLine(wrapper.getContext(), shape);\n      } else if (shape.type === 'eraser') {\n        drawEraser(wrapper.getContext(), shape);\n      } else if (shape.type === 'rect') {\n        drawRect(wrapper.getContext(), shape);\n      }\n    }\n  }\n\n  clear(wrapper: CanvasWrapper = this.lowerWrapper) {\n    wrapper.clear();\n  }\n\n  clearBoard() {\n    this.clear(this.lowerWrapper);\n    this.clear(this.upperWrapper);\n    this.worker.clearAll();\n  }\n}\n","import { Root, Point, Box } from 'features/docSlices';\nimport { ToolType } from 'features/boardSlices';\nimport Board from 'components/Editor/DrawingBoard/Canvas/Board';\nimport { fixEraserPoint } from '../line';\nimport Worker, { MouseDownCallback, MouseMoveCallback, MouseUpCallback } from './Worker';\nimport { compressPoints, checkLineIntersection, isInnerBox, isSelectable } from '../utils';\nimport * as scheduler from '../scheduler';\n\nclass EraserWorker extends Worker {\n  type = ToolType.Eraser;\n\n  update: Function;\n\n  board: Board;\n\n  private eraserBoxSize: number = 24;\n\n  private selectPoint: Point[] = [];\n\n  constructor(update: Function, board: Board) {\n    super();\n    this.update = update;\n    this.board = board;\n  }\n\n  mousedown(point: Point, callback: MouseDownCallback): void {\n    this.selectPoint = [point, point];\n\n    callback({ eraserPoints: [...this.selectPoint] });\n  }\n\n  mousemove(point: Point, callback: MouseMoveCallback) {\n    scheduler.reserveTask(point, (tasks: Array<scheduler.Task>) => {\n      const points = compressPoints(tasks);\n\n      if (tasks.length < 2) {\n        return;\n      }\n\n      this.update((root: Root) => {\n        const pointStart = fixEraserPoint(points[0]);\n        const pointEnd = fixEraserPoint(points[points.length - 1]);\n\n        const findAndRemoveShape = (point1: Point, point2: Point) => {\n          for (const shape of root.shapes) {\n            if (shape.type === 'eraser') {\n              continue;\n            }\n\n            if (isSelectable(shape)) {\n              if (isInnerBox(shape.box, point2)) {\n                this.deleteByID(root, shape.getID());\n              }\n            } else {\n              for (let i = 1; i < shape.points.length; i += 1) {\n                const shapePoint1 = shape.points[i - 1];\n                const shapePoint2 = shape.points[i];\n\n                if (isInnerBox(this.eraserBox(point2), shapePoint2)) {\n                  this.deleteByID(root, shape.getID());\n                  break;\n                }\n\n                if (isInnerBox(this.eraserBox(point1), shapePoint2)) {\n                  this.deleteByID(root, shape.getID());\n                  break;\n                }\n\n                const result = checkLineIntersection(point1, point2, shapePoint1, shapePoint2);\n                if (result.onLine1 && result.onLine2) {\n                  this.deleteByID(root, shape.getID());\n                  break;\n                }\n              }\n            }\n          }\n        };\n\n        if (this.selectPoint.length > 0) {\n          const lastPoint = this.selectPoint[this.selectPoint.length - 1];\n          findAndRemoveShape(lastPoint, pointStart);\n        }\n\n        findAndRemoveShape(pointStart, pointEnd);\n\n        this.board.drawAll(root.shapes);\n        this.selectPoint = [pointStart, pointEnd];\n\n        callback({ eraserPoints: [...this.selectPoint] });\n      });\n    });\n  }\n\n  mouseup(callback: MouseUpCallback) {\n    this.flushTask();\n    callback({});\n  }\n\n  flushTask() {\n    scheduler.flushTask();\n    this.selectPoint = [];\n  }\n\n  eraserBox(point: Point): Box {\n    const x = point.x - this.eraserBoxSize / 2;\n    const y = point.y - this.eraserBoxSize / 2;\n    const width = this.eraserBoxSize;\n    const height = this.eraserBoxSize;\n\n    return { y, x, width, height };\n  }\n}\n\nexport default EraserWorker;\n","import { Root, Point, Shape } from 'features/docSlices';\nimport { ToolType } from 'features/boardSlices';\nimport Board from 'components/Editor/DrawingBoard/Canvas/Board';\nimport { isInnerBox, cloneBox, isSelectable } from '../utils';\nimport Worker from './Worker';\nimport * as scheduler from '../scheduler';\n\nclass SelectorWorker extends Worker {\n  type = ToolType.Selector;\n\n  update: Function;\n\n  board: Board;\n\n  private selectedShape?: { shape: Shape; point: Point };\n\n  constructor(update: Function, board: Board) {\n    super();\n    this.update = update;\n    this.board = board;\n  }\n\n  mousedown(point: Point): void {\n    const target = this.findTarget(point);\n    if (target) {\n      this.selectedShape = {\n        shape: target,\n        point,\n      };\n      return;\n    }\n\n    this.selectedShape = undefined;\n  }\n\n  mousemove(point: Point) {\n    scheduler.reserveTask(point, (tasks: Array<scheduler.Task>) => {\n      if (tasks.length < 2) {\n        return;\n      }\n\n      this.update((root: Root) => {\n        if (this.isEmptySelectedShape()) {\n          return;\n        }\n\n        const lastShape = this.getElementByID(root, this.selectedShape!.shape.getID());\n        if (!lastShape || lastShape.type !== 'rect') {\n          return;\n        }\n\n        if (isSelectable(lastShape)) {\n          const pointEnd = tasks[tasks.length - 1];\n          const offsetY = pointEnd.y - this.selectedShape!.point.y;\n          const offsetX = pointEnd.x - this.selectedShape!.point.x;\n          this.selectedShape!.point = pointEnd;\n\n          lastShape.box = {\n            ...cloneBox(lastShape.box),\n            y: lastShape.box.y + offsetY,\n            x: lastShape.box.x + offsetX,\n          };\n\n          lastShape.points[0] = {\n            y: lastShape.points[0].y + offsetY,\n            x: lastShape.points[0].x + offsetX,\n          };\n        }\n        this.board.drawAll(root.shapes);\n      });\n    });\n  }\n\n  mouseup() {\n    this.flushTask();\n  }\n\n  flushTask() {\n    scheduler.flushTask();\n  }\n\n  /**\n   * Check if there is a selected shape.\n   */\n  isEmptySelectedShape() {\n    return !this.selectedShape;\n  }\n\n  /**\n   * findTarget find the shape in the document.\n   */\n  findTarget(point: Point): Shape | undefined {\n    let target;\n    this.update((root: Root) => {\n      for (const shape of root.shapes) {\n        if (shape.type === 'rect' && isInnerBox(shape.box, point)) {\n          target = shape;\n          return;\n        }\n      }\n    });\n    return target;\n  }\n}\n\nexport default SelectorWorker;\n","import Board from 'components/Editor/DrawingBoard/Canvas/Board';\nimport { ToolType } from 'features/boardSlices';\nimport Worker from './Worker';\n\nclass NoneWorker extends Worker {\n  type = ToolType.None;\n\n  update: Function;\n\n  board: Board;\n\n  constructor(update: Function, board: Board) {\n    super();\n    this.update = update;\n    this.board = board;\n  }\n\n  mousedown() {}\n\n  mousemove() {}\n\n  mouseup() {}\n\n  flushTask() {}\n}\n\nexport default NoneWorker;\n","import React, { useEffect, useRef } from 'react';\nimport { useDispatch, useSelector } from 'react-redux';\n\nimport { AppState } from 'app/rootReducer';\nimport { ToolType, setTool } from 'features/boardSlices';\nimport { Presence } from 'features/peerSlices';\nimport { BoardPresence } from './Canvas/Worker';\nimport Board from './Canvas/Board';\n\nexport default function DrawingBoard({ width, height }: { width: number; height: number }) {\n  const canvasRef = useRef<HTMLCanvasElement>(null);\n  const boardRef = useRef<Board | null>(null);\n  const dispatch = useDispatch();\n  const client = useSelector((state: AppState) => state.docState.client);\n  const doc = useSelector((state: AppState) => state.docState.doc);\n  const tool = useSelector((state: AppState) => state.boardState.toolType);\n  const color = useSelector((state: AppState) => state.boardState.color);\n\n  useEffect(() => {\n    if (!canvasRef.current) {\n      return () => {};\n    }\n    const board = new Board(canvasRef.current, doc!.update.bind(doc));\n    boardRef.current = board;\n\n    return () => {\n      board.destroy();\n    };\n  }, [doc]);\n\n  useEffect(() => {\n    if (!doc) {\n      return () => {};\n    }\n\n    const unsubscribe = doc.subscribe((event) => {\n      if (event.type === 'remote-change') {\n        boardRef.current?.drawAll(doc.getRoot().shapes);\n      }\n    });\n\n    return () => {\n      unsubscribe();\n    };\n  }, [doc]);\n\n  useEffect(() => {\n    if (!client || !doc) {\n      return () => {};\n    }\n\n    const unsubscribe = client.subscribe((event) => {\n      if (event.type === 'peers-changed') {\n        const documentKey = doc.getKey();\n        const changedPeers = event.value[documentKey];\n\n        for (const peerKey of Object.keys(changedPeers)) {\n          boardRef.current?.updatePresence(peerKey, changedPeers[peerKey]);\n        }\n      }\n    });\n\n    const clientId = client.getID()!;\n    const handleUpdateMeta = (data: BoardPresence) => {\n      const board = JSON.stringify(data || '');\n      boardRef.current?.updatePresence(clientId, {\n        board,\n      } as Presence);\n      client?.updatePresence('board', board);\n    };\n\n    boardRef.current?.addEventListener('mousemove', handleUpdateMeta);\n    boardRef.current?.addEventListener('mousedown', handleUpdateMeta);\n    boardRef.current?.addEventListener('mouseout', handleUpdateMeta);\n    boardRef.current?.addEventListener('mouseup', handleUpdateMeta);\n\n    return () => {\n      unsubscribe();\n      boardRef.current?.removeEventListener('mousemove', handleUpdateMeta);\n      boardRef.current?.removeEventListener('mousedown', handleUpdateMeta);\n      boardRef.current?.removeEventListener('mouseout', handleUpdateMeta);\n      boardRef.current?.removeEventListener('mouseup', handleUpdateMeta);\n    };\n  }, [client, doc]);\n\n  useEffect(() => {\n    const handleMouseup = () => {\n      if (tool === ToolType.Rect) {\n        dispatch(setTool(ToolType.Selector));\n      }\n    };\n\n    boardRef.current?.addEventListener('mouseup', handleMouseup);\n    return () => {\n      boardRef.current?.removeEventListener('mouseup', handleMouseup);\n    };\n  }, [doc, tool, dispatch]);\n\n  useEffect(() => {\n    if (!canvasRef.current) {\n      return;\n    }\n\n    boardRef.current?.setWidth(width);\n    boardRef.current?.setHeight(height);\n    boardRef.current?.drawAll(doc!.getRoot().shapes);\n  }, [doc, width, height]);\n\n  useEffect(() => {\n    boardRef.current?.setTool(tool);\n  }, [doc, tool]);\n\n  useEffect(() => {\n    boardRef.current?.setColor(color);\n  }, [doc, color]);\n\n  useEffect(() => {\n    if (tool === ToolType.Clear) {\n      boardRef.current?.clearBoard();\n      dispatch(setTool(ToolType.None));\n    }\n  }, [doc, tool, dispatch]);\n\n  return <canvas ref={canvasRef} />;\n}\n","import React from 'react';\nimport SvgIcon, { SvgIconProps } from '@material-ui/core/SvgIcon';\n\nexport default function Eraser({ fontSize }: SvgIconProps) {\n  return (\n    <SvgIcon fontSize={fontSize}>\n      <svg version=\"1.1\" id=\"Layer_1\" x=\"0px\" y=\"0px\" viewBox=\"0 0 480.001 480.001\">\n        <g>\n          <g>\n            <path\n              d=\"M333.142,350.846c0.115-0.115,0.215-0.239,0.323-0.357l129.681-129.706c10.878-10.878,16.864-25.368,16.855-40.8\n          c-0.01-15.409-5.999-29.865-16.854-40.694l-97.844-97.874c-10.853-10.845-25.326-16.817-40.75-16.817\n          c-15.426,0-29.895,5.974-40.741,16.82L16.855,308.329C5.974,319.21-0.012,333.713,0,349.168\n          c0.013,15.425,6.002,29.884,16.854,40.7l62.592,62.606c0.061,0.061,0.127,0.112,0.188,0.171c0.174,0.165,0.349,0.331,0.534,0.483\n          c0.082,0.067,0.171,0.126,0.255,0.19c0.175,0.135,0.349,0.271,0.532,0.395c0.07,0.047,0.145,0.085,0.215,0.13\n          c0.205,0.131,0.412,0.26,0.627,0.376c0.051,0.026,0.103,0.048,0.154,0.074c0.239,0.123,0.482,0.241,0.732,0.346\n          c0.033,0.014,0.067,0.024,0.101,0.037c0.269,0.108,0.54,0.208,0.819,0.293c0.034,0.011,0.07,0.017,0.104,0.027\n          c0.276,0.081,0.556,0.154,0.841,0.211c0.082,0.017,0.165,0.023,0.247,0.038c0.239,0.041,0.479,0.084,0.724,0.107\n          c0.33,0.033,0.663,0.051,0.998,0.051h137.91h159.308c5.522,0,10-4.478,10-10c0-5.522-4.478-10-10-10H248.566l84.22-84.236\n          C332.904,351.06,333.027,350.96,333.142,350.846z M220.285,435.404H90.66l-59.675-59.689\n          c-7.076-7.054-10.977-16.487-10.985-26.563c-0.008-10.106,3.897-19.582,10.996-26.681l129.825-129.803l151.091,151.091\n          L220.285,435.404z M174.965,178.527L297.953,55.56c7.069-7.069,16.516-10.963,26.6-10.963c10.085,0,19.536,3.895,26.609,10.962\n          l97.85,97.88c7.08,7.063,10.982,16.493,10.989,26.557c0.006,10.085-3.899,19.547-10.998,26.645l-122.95,122.974L174.965,178.527z\"\n            />\n          </g>\n        </g>\n      </svg>\n    </SvgIcon>\n  );\n}\n","import React from 'react';\nimport SvgIcon, { SvgIconProps } from '@material-ui/core/SvgIcon';\n\nexport default function Mouse({ fontSize }: SvgIconProps) {\n  return (\n    <SvgIcon fontSize={fontSize}>\n      <svg viewBox=\"-36 0 392 392.40392\" xmlns=\"http://www.w3.org/2000/svg\">\n        <path d=\"m43 355.03125c.492188 3.949219 3.273438 7.230469 7.085938 8.355469 3.816406 1.128906 7.933593-.109375 10.492187-3.152344l68.5-81.507813 72.972656 109.230469c3.058594 4.585938 9.25 5.828125 13.84375 2.777344l65.226563-43.285156c4.589844-3.046875 5.851562-9.234375 2.820312-13.835938l-72.304687-109.675781 101.714843-31.453125c3.800782-1.175781 6.542969-4.488281 6.984376-8.441406.441406-3.953125-1.5-7.792969-4.945313-9.777344l-300.195313-172.929687c-3.289062-1.894532-7.363281-1.765626-10.523437.332031-3.160156 2.097656-4.863281 5.804687-4.394531 9.566406zm242.539062-174.878906-92.539062 28.617187c-3.003906.929688-5.398438 3.21875-6.460938 6.179688-1.058593 2.960937-.664062 6.25 1.066407 8.875l74.152343 112.476562-48.613281 32.261719-74.832031-112.023438c-1.746094-2.617187-4.625-4.257812-7.765625-4.429687-.183594-.011719-.367187-.015625-.550781-.015625-2.953125 0-5.753906 1.308594-7.652344 3.566406l-62.320312 74.152344-37.421876-301.128906zm0 0\" />\n      </svg>\n    </SvgIcon>\n  );\n}\n","import React from 'react';\nimport SvgIcon, { SvgIconProps } from '@material-ui/core/SvgIcon';\n\nexport default function Rect({ fontSize }: SvgIconProps) {\n  return (\n    <SvgIcon fontSize={fontSize}>\n      <svg enableBackground=\"new 0 0 506.1 506.1\" viewBox=\"0 0 506.1 506.1\" xmlns=\"http://www.w3.org/2000/svg\">\n        <path d=\"m489.609 506.1h-473.118c-9.108 0-16.491-7.384-16.491-16.491v-473.118c0-9.108 7.383-16.491 16.491-16.491h473.119c9.107 0 16.49 7.383 16.49 16.491v473.118c0 9.107-7.383 16.491-16.491 16.491zm-456.628-32.982h440.138v-440.137h-440.138z\" />\n      </svg>\n    </SvgIcon>\n  );\n}\n","/* eslint-disable react-hooks/exhaustive-deps */\nimport React, { useCallback, useEffect, ChangeEvent } from 'react';\nimport { ActionCreatorWithPayload } from '@reduxjs/toolkit';\nimport { useSelector, useDispatch } from 'react-redux';\nimport Box from '@material-ui/core/Box';\nimport Switch from '@material-ui/core/Switch';\nimport Select from '@material-ui/core/Select';\nimport MenuItem from '@material-ui/core/MenuItem';\nimport Typography from '@material-ui/core/Typography';\nimport FormControl from '@material-ui/core/FormControl';\nimport { createStyles, makeStyles } from '@material-ui/core/styles';\n\nimport { Preview, setPreview } from 'features/docSlices';\nimport { Theme, CodeKeyMap, TabSize, setDarkMode, setCodeKeyMap, setTabSize } from 'features/settingSlices';\nimport { AppState } from 'app/rootReducer';\n\nconst useStyles = makeStyles((theme) =>\n  createStyles({\n    root: {\n      minWidth: '320px',\n      borderRadius: '4px',\n    },\n    header: {\n      borderBottom: `1px solid ${theme.palette.text.disabled}`,\n    },\n    title: {\n      padding: '12px 16px',\n    },\n    list: {\n      padding: '8px 18px 18px 18px',\n      lineHeight: '19px',\n    },\n    item: {\n      display: 'flex',\n      justifyContent: 'space-between',\n      fontSize: '15px',\n      marginTop: '12px',\n    },\n    itemTitle: {\n      whiteSpace: 'nowrap',\n      display: 'flex',\n      alignItems: 'center',\n    },\n    itemInfo: {\n      minWidth: 140,\n      paddingLeft: '12px',\n      borderRadius: '4px',\n      textAlign: 'left',\n    },\n  }),\n);\n\nexport default function Settings() {\n  const dispatch = useDispatch();\n  const classes = useStyles();\n\n  const doc = useSelector((state: AppState) => state.docState.doc);\n  const preview = useSelector((state: AppState) => state.docState.preview);\n  const menu = useSelector((state: AppState) => state.settingState.menu);\n\n  useEffect(() => {\n    if (!doc) {\n      return () => {};\n    }\n\n    const unsubscribe = doc.subscribe((event) => {\n      if (event.type === 'remote-change') {\n        dispatch(setPreview(doc.getRoot().preview || Preview.HTML));\n      }\n    });\n\n    return () => {\n      unsubscribe();\n    };\n  }, [doc]);\n\n  const handlePreviewChange = useCallback(\n    (event: ChangeEvent<{ name?: string; value: unknown }>) => {\n      if (!doc) {\n        return;\n      }\n      const value = event.target.value as Preview;\n      doc.update((root) => {\n        // eslint-disable-next-line no-param-reassign\n        root.preview = value;\n      });\n\n      dispatch(setPreview(value));\n    },\n    [doc, dispatch],\n  );\n\n  function handleChange<T>(action: ActionCreatorWithPayload<T>) {\n    return (event: ChangeEvent<{ name?: string; value: unknown }>) => {\n      dispatch(action(event.target.value as T));\n    };\n  }\n\n  const handleThemeChanged = useCallback(\n    (input, checked) => {\n      dispatch(setDarkMode(checked));\n    },\n    [dispatch, setDarkMode],\n  );\n\n  return (\n    <div className={classes.root}>\n      <Box>\n        <header className={classes.header}>\n          <Typography className={classes.title} variant=\"h6\">\n            Settings\n          </Typography>\n        </header>\n      </Box>\n      <div className={classes.list}>\n        <div className={classes.item}>\n          <div className={classes.itemTitle}>Preview</div>\n          <FormControl className={classes.itemInfo}>\n            <Select name=\"preview\" value={preview} onChange={handlePreviewChange} displayEmpty>\n              {Object.entries(Preview).map(([display, value]: [string, string]) => {\n                return (\n                  <MenuItem value={value} key={value}>\n                    {display}\n                  </MenuItem>\n                );\n              })}\n            </Select>\n          </FormControl>\n        </div>\n        <div className={classes.item}>\n          <div className={classes.itemTitle}>Tab Size</div>\n          <FormControl className={classes.itemInfo}>\n            <Select value={menu.tabSize} onChange={handleChange(setTabSize)} displayEmpty>\n              {Object.entries(TabSize).map(([key, tabSize]: [string, string]) => {\n                return (\n                  <MenuItem value={tabSize} key={key}>\n                    {`${tabSize} spaces`}\n                  </MenuItem>\n                );\n              })}\n            </Select>\n          </FormControl>\n        </div>\n        <div className={classes.item}>\n          <div className={classes.itemTitle}>Key Binding</div>\n          <FormControl className={classes.itemInfo}>\n            <Select value={menu.codeKeyMap} onChange={handleChange(setCodeKeyMap)} displayEmpty>\n              {Object.entries(CodeKeyMap).map(([display, codeKeyMap]: [string, string]) => {\n                return (\n                  <MenuItem value={codeKeyMap} key={codeKeyMap}>\n                    {display}\n                  </MenuItem>\n                );\n              })}\n            </Select>\n          </FormControl>\n        </div>\n        <div className={classes.item}>\n          <div className={classes.itemTitle}>Dark Mode</div>\n          <FormControl className={classes.itemInfo}>\n            <Switch checked={menu.theme === Theme.Dark} onChange={handleThemeChanged} />\n          </FormControl>\n        </div>\n      </div>\n    </div>\n  );\n}\n","/* eslint-disable react-hooks/exhaustive-deps */\nimport React, { useCallback, useState, MouseEvent } from 'react';\nimport { useSelector, useDispatch } from 'react-redux';\n\nimport Badge from '@material-ui/core/Badge';\nimport Avatar from '@material-ui/core/Avatar';\nimport IconButton from '@material-ui/core/IconButton';\nimport Tooltip from '@material-ui/core/Tooltip';\nimport Box from '@material-ui/core/Box';\nimport { createStyles, makeStyles } from '@material-ui/core/styles';\n\nimport Popover from 'components/commons/Popover';\nimport { AppState } from 'app/rootReducer';\nimport { ToolType, setTool, Color, setColor } from 'features/boardSlices';\nimport SvgIcon, { SvgIconProps } from '@material-ui/core/SvgIcon';\n\nconst useStyles = makeStyles((theme) =>\n  createStyles({\n    button: {\n      marginLeft: 3,\n      marginRight: 3,\n      padding: 8,\n    },\n    select: {\n      marginLeft: 3,\n      marginRight: 3,\n      padding: 8,\n      color: theme.palette.primary.main,\n    },\n    box: {\n      width: '184px',\n      display: 'flex',\n      flexWrap: 'wrap',\n      '& > *': {\n        margin: theme.spacing(1),\n      },\n    },\n    colorIcon: {\n      '&:hover': {\n        cursor: 'pointer',\n      },\n      width: theme.spacing(3.1),\n      height: theme.spacing(3.1),\n    },\n    badge: {\n      backgroundColor: ({ color }: { color: Color }) => color,\n    },\n  }),\n);\n\ninterface ButtonWithColorProps extends SvgIconProps {\n  tooltip: string;\n  toolType: ToolType;\n  Icon: typeof SvgIcon;\n}\n\nexport default function ButtonWithColor({ toolType, Icon, tooltip, fontSize }: ButtonWithColorProps) {\n  const dispatch = useDispatch();\n  const currentToolType = useSelector((state: AppState) => state.boardState.toolType);\n  const color = useSelector((state: AppState) => state.boardState.color);\n  const [anchorEl, setAnchorEl] = useState<HTMLButtonElement | undefined>();\n  const classes = useStyles({ color });\n\n  const handleOpen = useCallback(\n    (event: MouseEvent<HTMLButtonElement>) => {\n      setAnchorEl(event.currentTarget);\n    },\n    [currentToolType],\n  );\n\n  const handleClose = useCallback(() => {\n    setAnchorEl(undefined);\n  }, []);\n\n  const handleSelectTool = useCallback(\n    (event: MouseEvent<HTMLButtonElement>) => {\n      if (currentToolType === toolType) {\n        handleOpen(event);\n        return;\n      }\n\n      dispatch(setTool(toolType));\n    },\n    [currentToolType, color],\n  );\n\n  const handleSelectColor = (nextColor: Color) => () => {\n    dispatch(setTool(toolType));\n    dispatch(setColor(nextColor));\n    handleClose();\n  };\n\n  return (\n    <>\n      <Tooltip title={tooltip} arrow className={currentToolType === toolType ? classes.select : classes.button}>\n        <IconButton aria-label={tooltip} onClick={handleSelectTool}>\n          {currentToolType === toolType ? (\n            <Badge\n              variant=\"dot\"\n              classes={{ badge: classes.badge }}\n              anchorOrigin={{\n                vertical: 'bottom',\n                horizontal: 'right',\n              }}\n            >\n              <Icon fontSize={fontSize} />\n            </Badge>\n          ) : (\n            <Icon fontSize={fontSize} />\n          )}\n        </IconButton>\n      </Tooltip>\n\n      <Popover\n        anchorEl={anchorEl}\n        onClose={handleClose}\n        anchorOrigin={{\n          vertical: 'top',\n          horizontal: 'left',\n        }}\n        transformOrigin={{\n          vertical: 'top',\n          horizontal: 'right',\n        }}\n      >\n        <Box p={2} className={classes.box}>\n          {Object.entries(Color).map(([name, _color]: [string, Color]) => {\n            const selected = color === _color && currentToolType === toolType;\n            return (\n              <Tooltip key={name} title={name} arrow>\n                <Box border={3} borderRadius=\"50%\" borderColor={selected ? 'primary.main' : ''}>\n                  <Avatar\n                    className={classes.colorIcon}\n                    style={{ backgroundColor: _color }}\n                    onClick={handleSelectColor(_color)}\n                  >\n                    {/* If there are no spaces, the default svg is output. */}{' '}\n                  </Avatar>\n                </Box>\n              </Tooltip>\n            );\n          })}\n        </Box>\n      </Popover>\n    </>\n  );\n}\n","import React, { useState, useCallback, MouseEvent } from 'react';\nimport { useDispatch, useSelector } from 'react-redux';\n\nimport IconButton from '@material-ui/core/IconButton';\nimport Tooltip from '@material-ui/core/Tooltip';\nimport Divider from '@material-ui/core/Divider';\nimport { createStyles, makeStyles } from '@material-ui/core/styles';\nimport TextFieldsIcon from '@material-ui/icons/TextFields';\nimport SettingsIcon from '@material-ui/icons/Settings';\nimport BrushIcon from '@material-ui/icons/Brush';\nimport DeleteOutlineIcon from '@material-ui/icons/DeleteOutline';\nimport GitHubIcon from '@material-ui/icons/GitHub';\n\nimport EraserIcon from 'assets/icons/Eraser';\nimport MouseIcon from 'assets/icons/Mouse';\nimport RectIcon from 'assets/icons/Rect';\nimport Popover from 'components/commons/Popover';\nimport Settings from 'components/Editor/Sidebar/Settings';\nimport ButtonWithColor from 'components/Editor/Sidebar/ButtonWithColor';\nimport { AppState } from 'app/rootReducer';\nimport { ToolType, setTool } from 'features/boardSlices';\n\nconst useStyles = makeStyles((theme) =>\n  createStyles({\n    root: {\n      marginTop: 60,\n      display: 'flex',\n      flexDirection: 'column',\n    },\n    divider: {\n      marginTop: 5,\n      marginBottom: 5,\n    },\n    button: {\n      marginLeft: 3,\n      marginRight: 3,\n      padding: 8,\n    },\n    select: {\n      marginLeft: 3,\n      marginRight: 3,\n      padding: 8,\n      color: theme.palette.primary.main,\n    },\n  }),\n);\n\nexport default function Sidebar() {\n  const classes = useStyles();\n  const dispatch = useDispatch();\n  const tool = useSelector((state: AppState) => state.boardState.toolType);\n  const [anchorEl, setAnchorEl] = useState<HTMLButtonElement | undefined>();\n\n  const handleSelectTool = (nextTool: ToolType) => () => {\n    dispatch(setTool(nextTool));\n  };\n\n  const handleSettingsClick = useCallback((event: MouseEvent<HTMLButtonElement>) => {\n    setAnchorEl(event.currentTarget);\n  }, []);\n\n  const handleSettingsClose = useCallback(() => {\n    setAnchorEl(undefined);\n  }, []);\n\n  return (\n    <div className={classes.root}>\n      <Tooltip title=\"Code\" arrow className={tool === ToolType.None ? classes.select : classes.button}>\n        <IconButton aria-label=\"Code\" onClick={handleSelectTool(ToolType.None)}>\n          <TextFieldsIcon fontSize=\"small\" />\n        </IconButton>\n      </Tooltip>\n      <ButtonWithColor toolType={ToolType.Line} Icon={BrushIcon} fontSize=\"small\" tooltip=\"Brush\" />\n      <ButtonWithColor toolType={ToolType.Rect} Icon={RectIcon} fontSize=\"small\" tooltip=\"Shape\" />\n      <Tooltip title=\"Selector\" arrow className={tool === ToolType.Selector ? classes.select : classes.button}>\n        <IconButton aria-label=\"selector\" onClick={handleSelectTool(ToolType.Selector)}>\n          <MouseIcon fontSize=\"small\" />\n        </IconButton>\n      </Tooltip>\n      <Tooltip title=\"Eraser\" arrow className={tool === ToolType.Eraser ? classes.select : classes.button}>\n        <IconButton aria-label=\"eraser\" onClick={handleSelectTool(ToolType.Eraser)}>\n          <EraserIcon fontSize=\"small\" />\n        </IconButton>\n      </Tooltip>\n      <Tooltip title=\"Clear\" arrow className={classes.button}>\n        <IconButton aria-label=\"selector\" onClick={handleSelectTool(ToolType.Clear)}>\n          <DeleteOutlineIcon fontSize=\"default\" />\n        </IconButton>\n      </Tooltip>\n      <Divider className={classes.divider} />\n      <Tooltip title=\"Settings\" arrow>\n        <IconButton aria-label=\"settings\" onClick={handleSettingsClick}>\n          <SettingsIcon fontSize=\"small\" />\n        </IconButton>\n      </Tooltip>\n      <Tooltip title=\"GitHub\" arrow className={classes.button}>\n        <IconButton aria-label=\"selector\" href=\"https://github.com/yorkie-team/codepair\">\n          <GitHubIcon fontSize=\"default\" />\n        </IconButton>\n      </Tooltip>\n      <Popover anchorEl={anchorEl} onClose={handleSettingsClose}>\n        <Settings />\n      </Popover>\n    </div>\n  );\n}\n","import React, { useEffect, useState, useRef, useCallback } from 'react';\nimport { createStyles, makeStyles } from '@material-ui/core/styles';\n\nimport CodeEditor from 'components/Editor/CodeEditor';\nimport DrawingBoard from 'components/Editor/DrawingBoard';\nimport Sidebar from 'components/Editor/Sidebar';\nimport { ToolType } from 'features/boardSlices';\n\nexport const NAVBAR_HEIGHT = 64;\nconst SIDEBAR_WIDTH = 46;\n\ninterface EditorProps {\n  tool: ToolType;\n}\n\nconst useStyles = makeStyles(() =>\n  createStyles({\n    root: {\n      flexGrow: 1,\n      display: 'flex',\n    },\n    editor: {\n      width: `calc(100% - ${SIDEBAR_WIDTH}px)`,\n      flex: '0 0 auto',\n    },\n    codeEditor: {\n      width: '100%',\n      height: `calc(100vh - ${NAVBAR_HEIGHT}px)`,\n    },\n    canvas: {\n      top: NAVBAR_HEIGHT,\n      height: `calc(100vh - ${NAVBAR_HEIGHT}px)`,\n      width: `calc(100% - ${SIDEBAR_WIDTH}px)`,\n      position: 'fixed',\n      /**\n       * pointer-events\n       *   - 'auto': Show code mirror first\n       *   - 'none': Show canvas first\n       */\n      pointerEvents: (tool: ToolType) => (tool === ToolType.None ? 'none' : 'auto'),\n    },\n  }),\n);\n\nexport default function Editor({ tool }: EditorProps) {\n  const classes = useStyles(tool);\n\n  const [width, setWidth] = useState(0);\n  const [height, setHeight] = useState(0);\n\n  const divRef = useRef<HTMLDivElement>(null);\n  const codeEditorRef = useRef<CodeMirror.Editor>(null);\n\n  const handleClickEditor = useCallback(() => {\n    if (tool === ToolType.None) {\n      codeEditorRef.current?.focus();\n    }\n  }, [tool]);\n\n  useEffect(() => {\n    const onResize = () => {\n      if (!divRef.current) {\n        return;\n      }\n\n      const rect = divRef.current?.getBoundingClientRect();\n      setWidth(rect.width);\n      setHeight(rect.height);\n    };\n\n    onResize();\n    window.addEventListener('resize', onResize);\n\n    return () => {\n      window.removeEventListener('resize', onResize);\n    };\n  }, []);\n\n  return (\n    <div className={classes.root} onClick={handleClickEditor} aria-hidden=\"true\">\n      <div className={classes.editor} ref={divRef}>\n        <div className={classes.codeEditor}>\n          <CodeEditor forwardedRef={codeEditorRef} />\n          <div id=\"tableOfContents\" style={{ display: 'none' }} />\n        </div>\n        <div className={classes.canvas}>\n          <DrawingBoard width={width} height={height} />\n        </div>\n      </div>\n      <Sidebar />\n    </div>\n  );\n}\n","/* eslint-disable react-hooks/exhaustive-deps */\nimport React, { useEffect } from 'react';\nimport { useSelector, useDispatch } from 'react-redux';\n\nimport { Box } from '@material-ui/core';\nimport Snackbar from '@material-ui/core/Snackbar';\nimport Alert from '@material-ui/lab/Alert';\nimport CircularProgress from '@material-ui/core/CircularProgress';\nimport { createStyles, makeStyles } from '@material-ui/core/styles';\nimport { AppState } from 'app/rootReducer';\nimport {\n  activateClient,\n  deactivateClient,\n  createDocument,\n  detachDocument,\n  attachDoc,\n  attachDocLoading,\n  CodeMode,\n  setCodeMode,\n  Preview,\n  setPreview,\n  DocStatus,\n  setStatus,\n} from 'features/docSlices';\nimport { syncPeer } from 'features/peerSlices';\nimport Editor, { NAVBAR_HEIGHT } from './Editor';\n\nconst useStyles = makeStyles(() =>\n  createStyles({\n    loading: {\n      display: 'flex',\n      height: `calc(100vh - ${NAVBAR_HEIGHT}px)`,\n      alignItems: 'center',\n      justifyContent: 'center',\n    },\n  }),\n);\n\n// eslint-disable-next-line func-names\nexport default function (props: { docKey: string }) {\n  const { docKey } = props;\n  const classes = useStyles();\n  const dispatch = useDispatch();\n  const client = useSelector((state: AppState) => state.docState.client);\n  const doc = useSelector((state: AppState) => state.docState.doc);\n  const status = useSelector((state: AppState) => state.docState.status);\n  const tool = useSelector((state: AppState) => state.boardState.toolType);\n  const loading = useSelector((state: AppState) => state.docState.loading);\n  const errorMessage = useSelector((state: AppState) => state.docState.errorMessage);\n\n  useEffect(() => {\n    dispatch(activateClient());\n    return () => {\n      dispatch(deactivateClient());\n    };\n  }, []);\n\n  useEffect(() => {\n    if (!client || !doc) {\n      return () => {};\n    }\n\n    const unsubscribe = client.subscribe((event) => {\n      if (event.type === 'peers-changed') {\n        const documentKey = doc.getKey();\n        const changedPeers = event.value[documentKey];\n        dispatch(\n          syncPeer({\n            myClientID: client.getID()!,\n            changedPeers,\n          }),\n        );\n      }\n\n      if (\n        status === DocStatus.Connect &&\n        ((event.type === 'status-changed' && event.value === 'deactivated') ||\n          (event.type === 'stream-connection-status-changed' && event.value === 'disconnected') ||\n          (event.type === 'document-synced' && event.value === 'sync-failed'))\n      ) {\n        dispatch(setStatus(DocStatus.Disconnect));\n      } else if (\n        status === DocStatus.Disconnect &&\n        (event.type === 'peers-changed' ||\n          event.type === 'documents-changed' ||\n          (event.type === 'status-changed' && event.value === 'activated') ||\n          (event.type === 'stream-connection-status-changed' && event.value === 'connected') ||\n          (event.type === 'document-synced' && event.value === 'synced'))\n      ) {\n        dispatch(setStatus(DocStatus.Connect));\n      }\n    });\n\n    return () => {\n      unsubscribe();\n    };\n  }, [client, doc, status]);\n\n  useEffect(() => {\n    dispatch(createDocument(docKey));\n    return () => {\n      dispatch(detachDocument());\n    };\n  }, [docKey]);\n\n  useEffect(() => {\n    async function attachDocAsync() {\n      if (!client || !doc) {\n        return;\n      }\n\n      dispatch(attachDocLoading(true));\n      await dispatch(attachDoc({ client, doc }));\n      dispatch(setCodeMode(doc.getRoot().mode || CodeMode.Markdown));\n      dispatch(setPreview(doc.getRoot().preview || Preview.HTML));\n      dispatch(attachDocLoading(false));\n    }\n\n    attachDocAsync();\n    return () => {\n      dispatch(attachDocLoading(true));\n    };\n  }, [docKey, client, doc]);\n\n  if (errorMessage) {\n    return (\n      <div>\n        <Snackbar open anchorOrigin={{ vertical: 'top', horizontal: 'center' }}>\n          <Alert severity=\"warning\">{errorMessage || 'fail to attach document'}</Alert>\n        </Snackbar>\n      </div>\n    );\n  }\n\n  if (loading || !client || !doc) {\n    return (\n      <Box className={classes.loading}>\n        <CircularProgress color=\"inherit\" />\n      </Box>\n    );\n  }\n\n  return <Editor tool={tool} />;\n}\n","import React, { useEffect } from 'react';\nimport { RouteComponentProps } from 'react-router';\nimport { useLocation } from 'react-router-dom';\nimport ReactGA from 'react-ga4';\nimport { createStyles, makeStyles } from '@material-ui/core/styles';\n\nimport NavBar from 'components/NavBar';\nimport Editor from 'components/Editor';\nimport { AppState } from 'app/rootReducer';\nimport { useSelector } from 'react-redux';\n\ntype DocPageProps = {\n  docKey: string;\n};\n\nconst useStyles = makeStyles(() =>\n  createStyles({\n    root: {\n      flexGrow: 1,\n    },\n  }),\n);\n\nexport default function DocPage(props: RouteComponentProps<DocPageProps>) {\n  const menu = useSelector((state: AppState) => state.settingState.menu);\n  const classes = useStyles();\n  const location = useLocation();\n  const {\n    match: { params },\n  } = props;\n  const { docKey } = params;\n\n  useEffect(() => {\n    if (`${process.env.REACT_APP_GOOGLE_ANALYTICS}`) {\n      ReactGA.send('pageview');\n    }\n  }, [location]);\n\n  return (\n    <div className={classes.root} data-theme={menu.theme}>\n      <NavBar />\n      <Editor docKey={docKey} />\n    </div>\n  );\n}\n","import React, { useMemo, useCallback } from 'react';\nimport { useSelector } from 'react-redux';\nimport { Router, Route, Redirect, Switch } from 'react-router-dom';\nimport { createBrowserHistory } from 'history';\nimport * as Sentry from '@sentry/react';\nimport { Integrations } from '@sentry/tracing';\nimport CssBaseline from '@material-ui/core/CssBaseline';\nimport { createMuiTheme, ThemeProvider } from '@material-ui/core/styles';\nimport { AppState } from 'app/rootReducer';\nimport { Theme } from 'features/settingSlices';\n\nimport DocPage from 'pages/DocPage';\n\nconst history = createBrowserHistory();\n\nif (process.env.NODE_ENV === 'production') {\n  Sentry.init({\n    dsn: `${process.env.REACT_APP_SENTRY_DSN}`,\n    release: `codepair@${process.env.REACT_APP_GIT_HASH}`,\n    integrations: [\n      new Integrations.BrowserTracing({\n        routingInstrumentation: Sentry.reactRouterV5Instrumentation(history),\n      }),\n    ],\n\n    // Set tracesSampleRate to 1.0 to capture 100%\n    // of transactions for performance monitoring.\n    // We recommend adjusting this value in production\n    tracesSampleRate: 1.0,\n  });\n}\n\nfunction App() {\n  const menu = useSelector((state: AppState) => state.settingState.menu);\n  const theme = useMemo(\n    () =>\n      createMuiTheme({\n        palette: {\n          type: menu.theme === Theme.Dark ? 'dark' : 'light',\n          primary: {\n            main: '#d8b01a',\n          },\n          secondary: {\n            main: '#e6b602',\n          },\n        },\n      }),\n    [menu],\n  );\n\n  const handleRender = useCallback(() => <Redirect to={`/${Math.random().toString(36).substring(7)}`} />, []);\n\n  return (\n    <ThemeProvider theme={theme}>\n      {/* CssBaseline kickstart an elegant, consistent, and simple baseline to build upon. */}\n      <CssBaseline />\n      <Router history={history}>\n        <Switch>\n          <Route path=\"/\" exact render={handleRender} />\n          <Route path=\"/:docKey\" exact component={DocPage} />\n        </Switch>\n      </Router>\n    </ThemeProvider>\n  );\n}\n\nexport default App;\n","import { combineReducers } from 'redux';\n\nimport docReducer from 'features/docSlices';\nimport peerReducer from 'features/peerSlices';\nimport settingReducer from 'features/settingSlices';\nimport boardReducer from 'features/boardSlices';\n\nconst rootReducer = combineReducers({\n  docState: docReducer,\n  peerState: peerReducer,\n  settingState: settingReducer,\n  boardState: boardReducer,\n});\n\nexport type AppState = ReturnType<typeof rootReducer>;\n\nexport default rootReducer;\n","import { configureStore, getDefaultMiddleware } from '@reduxjs/toolkit';\n\nimport rootReducer from './rootReducer';\n\nconst store = configureStore({\n  reducer: rootReducer,\n  middleware: getDefaultMiddleware({\n    serializableCheck: {\n      ignoredActions: ['doc/attach/fulfilled', 'doc/activate/fulfilled'],\n      ignoredPaths: ['docState.client', 'docState.doc'],\n    },\n    immutableCheck: {\n      ignoredPaths: ['docState.client', 'docState.doc'],\n    },\n  }),\n});\n\nexport default store;\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/,\n    ),\n);\n\ntype Config = {\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\n};\n\nexport function register(config?: Config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA',\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl: string, config?: Config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then((registration) => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.',\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch((error) => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' },\n  })\n    .then((response) => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then((registration) => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.',\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready\n      .then((registration) => {\n        registration.unregister();\n      })\n      .catch((error) => {\n        console.error(error.message);\n      });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport { Provider } from 'react-redux';\nimport ReactGA from 'react-ga4';\nimport App from 'app/App';\nimport store from 'app/store';\n\nimport * as serviceWorker from 'serviceWorker';\nimport './index.scss';\n\nconst trackingCode = `${process.env.REACT_APP_GOOGLE_ANALYTICS}`;\nif (trackingCode) {\n  ReactGA.initialize(trackingCode);\n}\n\nReactDOM.render(\n  <Provider store={store}>\n    <App />\n  </Provider>,\n  document.querySelector('#root'),\n);\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}